# ShiroPro Tools (Reborn) - ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—æ©Ÿèƒ½ä»•æ§˜æ›¸

**Version**: 1.0  
**Last Updated**: 2025-12-07  
**Purpose**: ç°¡æ˜“ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—æ©Ÿèƒ½ã®å®Œå…¨ãªä»•æ§˜å®šç¾©

---

## ğŸ“‹ ç›®æ¬¡

1. [æ©Ÿèƒ½æ¦‚è¦](#æ©Ÿèƒ½æ¦‚è¦)
2. [ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—ä»•æ§˜](#ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—ä»•æ§˜)
3. [UIè¨­è¨ˆ](#uiè¨­è¨ˆ)
4. [DPSè¨ˆç®—](#dpsè¨ˆç®—)
5. [ãƒ‡ãƒ¼ã‚¿æ§‹é€ ](#ãƒ‡ãƒ¼ã‚¿æ§‹é€ )
6. [å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³](#å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³)

---

## æ©Ÿèƒ½æ¦‚è¦

### ã‚³ãƒ³ã‚»ãƒ—ãƒˆ

ã‚¢ã‚¿ãƒƒã‚«ãƒ¼ã‚’ä¸€è¦§è¡¨ç¤ºã—ã€ç’°å¢ƒãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§å„ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ã¨DPSãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«å¤‰å‹•ã™ã‚‹ç°¡æ˜“ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—ãƒ„ãƒ¼ãƒ«ã€‚

### ä¸»è¦æ©Ÿèƒ½

1. **ç’°å¢ƒè¨­å®šãƒ‘ãƒãƒ«**
   - é¼“èˆï¼ˆå›ºå®šå€¤åŠ ç®—ï¼‰
   - è¢«ãƒ€ãƒ¡ãƒ¼ã‚¸%
   - åŠ¹æœé‡è¤‡ãƒãƒ•%
   - æ•µé˜²å¾¡åŠ›
   - æ”»æ’ƒé€Ÿåº¦%ã€éš™çŸ­ç¸®%

2. **ã‚¢ã‚¿ãƒƒã‚«ãƒ¼ä¸€è¦§ï¼ˆã‚«ãƒ¼ãƒ‰è¡¨ç¤ºï¼‰**
   - è¶…ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã‚«ãƒ¼ãƒ‰ï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—6åˆ—ã‚°ãƒªãƒƒãƒ‰ï¼‰
   - æœ€çµ‚ãƒ€ãƒ¡ãƒ¼ã‚¸ã¨å·®åˆ†è¡¨ç¤º
   - DPSã¨å·®åˆ†è¡¨ç¤º
   - é¼“èˆé‡ã®è¡¨ç¤ºï¼ˆè©²å½“ã‚­ãƒ£ãƒ©ã®ã¿ï¼‰
   - ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§é †ç•ªå…¥ã‚Œæ›¿ãˆ

3. **è©³ç´°ãƒ‘ãƒãƒ«**
   - å„ãƒ•ã‚§ãƒ¼ã‚ºã®ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è¡¨ç¤º
   - ãƒãƒ•ã®é©ç”¨çŠ¶æ³è©³ç´°

4. **ç·¨æˆç®¡ç†**
   - ãƒ‘ãƒ¼ã‚µãƒ¼ã§è§£æã—ãŸã‚­ãƒ£ãƒ©ã‚’ç™»éŒ²
   - ç·¨æˆã®ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿
   - ã‚­ãƒ£ãƒ©ã®è¿½åŠ ãƒ»å‰Šé™¤

---

## ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—ä»•æ§˜

### è¨ˆç®—ãƒ•ã‚§ãƒ¼ã‚ºã®å…¨ä½“åƒ

```
Phase 1: æ”»æ’ƒåŠ›ã®ç¢ºå®š
  â†“
Phase 2: ãƒ€ãƒ¡ãƒ¼ã‚¸å€ç‡ã®é©ç”¨
  â†“
Phase 3: é˜²å¾¡åŠ›ã«ã‚ˆã‚‹æ¸›ç®—
  â†“
Phase 4: ä¸ãƒ€ãƒ¡ãƒ»è¢«ãƒ€ãƒ¡ã«ã‚ˆã‚‹å¢—æ¸›
  â†“
Phase 5: é€£æ’ƒã«ã‚ˆã‚‹ä¹—ç®—ï¼ˆãƒ¬ã‚¢ã‚±ãƒ¼ã‚¹ï¼‰
  â†“
æœ€çµ‚ãƒ€ãƒ¡ãƒ¼ã‚¸
```

### Phase 1: æ”»æ’ƒåŠ›ã®ç¢ºå®š

```
finalAttack = [(baseAttack Ã— (1 + Î£ percentBuffs / 100)) + Î£ flatBuffs + Î£ additiveBuffs] Ã— (1 + Î£ duplicateBuffs / 100)
```

**é‡è¦ãƒ«ãƒ¼ãƒ«:**
- å‰²åˆãƒãƒ•: **åŒç¨®ã¯æœ€å¤§å€¤ã®ã¿é©ç”¨**ï¼ˆåŠ ç®—ã•ã‚Œãªã„ï¼‰
- å›ºå®šå€¤ãƒãƒ•: ã™ã¹ã¦åŠ ç®—
- åŠ ç®—ãƒãƒ•: **åŸºç¤æ”»æ’ƒåŠ›ã‚’å‚ç…§**ã—ã¦è¨ˆç®—ï¼ˆè¤‡æ•°ã®å ´åˆã¯åˆè¨ˆã¨ä»®å®šï¼‰
- å‰²åˆé‡è¤‡ãƒãƒ•: ã™ã¹ã¦åŠ ç®—ã—ã¦ã‹ã‚‰æœ€å¾Œã«ä¹—ç®—

**ç‰¹æ®ŠãªæŒ™å‹•: å°„ç¨‹å†…é‡è¤‡ãƒãƒ•ã¨åŠ ç®—ãƒãƒ•ã®ç›¸äº’ä½œç”¨**

åŠ ç®—ãƒãƒ•åŸå¨˜ã‚’é…ç½®ã—ãŸå¾Œã«å°„ç¨‹å†…é‡è¤‡ãƒãƒ•ã‚’ç™ºå‹•ã™ã‚‹ã¨ã€**åŠ ç®—ãƒãƒ•è‡ªä½“ã‚‚é‡è¤‡ãƒãƒ•ã§ä¹—ç®—ã•ã‚Œã‚‹**ã€‚

```
ä¾‹: åŸºç¤æ”»æ’ƒ1000ã€åŠ ç®—ãƒãƒ•40%ã€é‡è¤‡ãƒãƒ•1.2å€
â†’ (1000 Ã— 1.2) + (1000 Ã— 0.4 Ã— 1.2) = 1200 + 480 = 1680
```

### Phase 2: ãƒ€ãƒ¡ãƒ¼ã‚¸å€ç‡ã®é©ç”¨

```
damage = finalAttack Ã— multiplierâ‚ Ã— multiplierâ‚‚ Ã— ... Ã— multiplierâ‚™
```

**ã™ã¹ã¦ã®å€ç‡ã¯å€‹åˆ¥ã«ä¹—ç®—**ã•ã‚Œã‚‹ï¼ˆåŠ ç®—ã§ã¯ãªã„ï¼‰ã€‚

å€ç‡ã®ç¨®é¡:
- ã€Œæ”»æ’ƒã®â—¯å€ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ã€
- ã€Œä¸ãˆã‚‹ãƒ€ãƒ¡ãƒ¼ã‚¸ãŒâ—¯å€ã€
- ã€Œç›´æ’ƒãƒœãƒ¼ãƒŠã‚¹ã€ï¼ˆä¸ãˆã‚‹ãƒ€ãƒ¡ãƒ¼ã‚¸ã¨åŒç¨®ï¼‰
- æ¡ä»¶ä»˜ããƒ€ãƒ¡ãƒ¼ã‚¸å€ç‡ï¼ˆã€Œè€ä¹…50%ä»¥ä¸‹ã§â—¯å€ã€ãªã©ï¼‰

### Phase 3: é˜²å¾¡åŠ›ã«ã‚ˆã‚‹æ¸›ç®—

```
effectiveDefense = max(0, (enemyDefense Ã— (1 - percentDebuffs / 100)) - flatDebuffs)
damage = max(1, damage - effectiveDefense)
```

**è¨ˆç®—é †åº:** å‰²åˆãƒ‡ãƒãƒ•ã‚’å…ˆã«é©ç”¨ â†’ å›ºå®šå€¤ã‚’å¼•ã

### Phase 4: ä¸ãƒ€ãƒ¡ãƒ»è¢«ãƒ€ãƒ¡ã«ã‚ˆã‚‹å¢—æ¸›

```
finalDamage = damage Ã— (1 + max(damageDealt)) Ã— (1 + max(damageTaken))
```

**é‡è¦:** ä¸ãƒ€ãƒ¡åŒå£«ã€è¢«ãƒ€ãƒ¡åŒå£«ã¯ãã‚Œãã‚Œ**æœ€å¤§å€¤ã®ã¿é©ç”¨**ï¼ˆåŠ ç®—ã•ã‚Œãªã„ï¼‰

### Phase 5: é€£æ’ƒã«ã‚ˆã‚‹ä¹—ç®—

```
totalDamage = damage Ã— attackCount
```

ãƒ¬ã‚¢ã‚±ãƒ¼ã‚¹ï¼ˆè–å¤œãƒ€ãƒã‚¿ãƒ¼ã®5é€£æ’ƒãªã©ï¼‰

---

## UIè¨­è¨ˆ

### ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

```
ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ï¼ˆ1920pxä»¥ä¸Šï¼‰: 6åˆ—
å¤§ç”»é¢ï¼ˆ1280px-1919pxï¼‰: 4åˆ—
ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆï¼ˆ768px-1279pxï¼‰: 3åˆ—
ãƒ¢ãƒã‚¤ãƒ«ï¼ˆ480px-767pxï¼‰: 2åˆ—
å°å‹ãƒ¢ãƒã‚¤ãƒ«ï¼ˆ479pxä»¥ä¸‹ï¼‰: 1åˆ—
```

### è¶…ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³

**ã‚«ãƒ¼ãƒ‰ã‚µã‚¤ã‚º:** ç´„180px Ã— 200px

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ‰ãƒ¬ãƒƒãƒ‰ãƒãƒ¼ãƒˆ â”‚  â† ã‚­ãƒ£ãƒ©åï¼ˆ6æ–‡å­—ã¾ã§ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸš¢ Lv120     â”‚  â† æ­¦å™¨ã‚¢ã‚¤ã‚³ãƒ³ + ãƒ¬ãƒ™ãƒ«
â”‚              â”‚
â”‚   15.2K      â”‚  â† æœ€çµ‚ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆè¡¨ç¤ºï¼‰
â”‚   â†‘ 14%      â”‚  â† å·®åˆ†
â”‚              â”‚
â”‚ âš¡ 206        â”‚  â† DPS
â”‚              â”‚
â”‚ ğŸ¯Ã—5         â”‚  â† ãƒãƒƒã‚¸ï¼ˆé€£æ’ƒãƒ»é¼“èˆï¼‰
â”‚              â”‚
â”‚  ğŸ“Š    ğŸ—‘ï¸    â”‚  â† ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆè©³ç´°ãƒ»å‰Šé™¤ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç’°å¢ƒè¨­å®šãƒ‘ãƒãƒ«

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç’°å¢ƒè¨­å®š                        [ãƒªã‚»ãƒƒãƒˆ] [ä¿å­˜]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é¼“èˆ: [+500] â”‚ è¢«ãƒ€ãƒ¡: [50]% â”‚ é‡è¤‡: [20]%         â”‚
â”‚ æ”»é€Ÿ: [30]%  â”‚ éš™çŸ­ç¸®: [40]% â”‚                     â”‚
â”‚ æ•µé˜²å¾¡: [300] â”‚ é˜²ãƒ‡ãƒãƒ•: [20]% [-100]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½

**å®Ÿè£…æ–¹æ³•:**

```typescript
import { DndContext, closestCenter, KeyboardSensor, PointerSensor, useSensor, useSensors } from '@dnd-kit/core';
import { arrayMove, SortableContext, sortableKeyboardCoordinates, rectSortingStrategy } from '@dnd-kit/sortable';
import { useSortable } from '@dnd-kit/sortable';
import { CSS } from '@dnd-kit/utilities';

// ã‚½ãƒ¼ãƒˆå¯èƒ½ãªã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
function SortableCharacterCard({ character, ...props }: CharacterCardProps) {
  const {
    attributes,
    listeners,
    setNodeRef,
    transform,
    transition,
    isDragging,
  } = useSortable({ id: character.id });

  const style = {
    transform: CSS.Transform.toString(transform),
    transition,
    opacity: isDragging ? 0.5 : 1,
  };

  return (
    <div ref={setNodeRef} style={style} {...attributes} {...listeners}>
      <CompactCharacterCard character={character} {...props} />
    </div>
  );
}

// ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
function DamageCalculator() {
  const [characters, setCharacters] = useState<Character[]>([]);
  
  const sensors = useSensors(
    useSensor(PointerSensor),
    useSensor(KeyboardSensor, {
      coordinateGetter: sortableKeyboardCoordinates,
    })
  );

  const handleDragEnd = (event: DragEndEvent) => {
    const { active, over } = event;

    if (over && active.id !== over.id) {
      setCharacters((items) => {
        const oldIndex = items.findIndex((item) => item.id === active.id);
        const newIndex = items.findIndex((item) => item.id === over.id);
        return arrayMove(items, oldIndex, newIndex);
      });
    }
  };

  return (
    <DndContext
      sensors={sensors}
      collisionDetection={closestCenter}
      onDragEnd={handleDragEnd}
    >
      <SortableContext
        items={characters.map(c => c.id)}
        strategy={rectSortingStrategy}
      >
        <div className="card-grid">
          {characters.map((character) => (
            <SortableCharacterCard
              key={character.id}
              character={character}
              result={results[character.id]}
              comparison={comparisons[character.id]}
              onShowDetails={() => showDetails(character.id)}
              onRemove={() => removeCharacter(character.id)}
            />
          ))}
        </div>
      </SortableContext>
    </DndContext>
  );
}
```

### è©³ç´°ãƒ‘ãƒãƒ«

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çµ¢çˆ›ãƒ€ãƒã‚¿ãƒ¼åŸ - ãƒ€ãƒ¡ãƒ¼ã‚¸è©³ç´°         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phase 1: æ”»æ’ƒåŠ›ã®ç¢ºå®š                â”‚
â”‚   åŸºç¤æ”»æ’ƒ: 1,000                    â”‚
â”‚   + è‡ªå·±å‰²åˆãƒãƒ•: 40% (æœ€å¤§å€¤)       â”‚
â”‚   + å›ºå®šå€¤ãƒãƒ•: +100                 â”‚
â”‚   + ç’°å¢ƒé¼“èˆ: +500                   â”‚
â”‚   Ã— è‡ªå·±é‡è¤‡: 1.2                    â”‚
â”‚   Ã— ç’°å¢ƒé‡è¤‡: 1.2                    â”‚
â”‚   = 2,880                            â”‚
â”‚                                      â”‚
â”‚ Phase 2: ãƒ€ãƒ¡ãƒ¼ã‚¸å€ç‡                â”‚
â”‚   Ã— æ”»æ’ƒã®2å€                        â”‚
â”‚   Ã— è€ä¹…50%ä»¥ä¸‹ 1.5å€                â”‚
â”‚   Ã— ä¸ãˆã‚‹ãƒ€ãƒ¡ãƒ¼ã‚¸ 1.3å€             â”‚
â”‚   Ã— è€ä¹…ä¾å­˜ 2.5å€ (æœ€å¤§)            â”‚
â”‚   = 28,080                           â”‚
â”‚                                      â”‚
â”‚ Phase 3: é˜²å¾¡åŠ›æ¸›ç®—                  â”‚
â”‚   æ•µé˜²å¾¡: 300 Ã— 0.8 - 0 = 240       â”‚
â”‚   = 27,840                           â”‚
â”‚                                      â”‚
â”‚ Phase 4: ä¸ãƒ€ãƒ¡ãƒ»è¢«ãƒ€ãƒ¡              â”‚
â”‚   Ã— è¢«ãƒ€ãƒ¡: 1.5 (æœ€å¤§å€¤)             â”‚
â”‚   = 41,760                           â”‚
â”‚                                      â”‚
â”‚ Phase 5: é€£æ’ƒ                        â”‚
â”‚   Ã— 5é€£æ’ƒ                            â”‚
â”‚   = 208,800                          â”‚
â”‚                                      â”‚
â”‚ DPSè¨ˆç®—                              â”‚
â”‚   æ”»æ’ƒãƒ•ãƒ¬ãƒ¼ãƒ : 19 / 1.3 = 14.6f     â”‚
â”‚   éš™ãƒ•ãƒ¬ãƒ¼ãƒ : 22 Ã— 0.6 = 13.2f       â”‚
â”‚   åˆè¨ˆ: 27.8f                        â”‚
â”‚   æ”»æ’ƒ/ç§’: 60 / 27.8 = 2.16          â”‚
â”‚   DPS: 208,800 Ã— 2.16 = 451,008      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## DPSè¨ˆç®—

### æ­¦å™¨ç¨®åˆ¥ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿

```typescript
const WEAPON_FRAMES: Record<string, WeaponFrameData> = {
  'åˆ€': { attack: 19, gap: 22, total: 41 },
  'æ§': { attack: 23, gap: 27, total: 50 },
  'æ§Œ': { attack: 27, gap: 30, total: 57 },
  'ç›¾': { attack: 24, gap: 30, total: 54 },
  'æ‹³': { attack: 37, gap: 18, total: 55 },
  'éŒ': { attack: 22, gap: 22, total: 44 },
  'æˆ¦æ£': { attack: 27, gap: 25, total: 52 },
  'åŒå‰£': { attack: 29, gap: 21, total: 50 },
  'ãƒ©ãƒ³ã‚¹': { attack: 27, gap: 27, total: 54 },
  'å¼“': { attack: 19, gap: 18, total: 37 },
  'çŸ³å¼“': { attack: 24, gap: 24, total: 48 },
  'é‰„ç ²': { attack: 29, gap: 27, total: 56 },
  'å¤§ç ²': { attack: 42, gap: 42, total: 84 },
  'æ­Œèˆ': { attack: 47, gap: 54, total: 101 },
  'æ³•è¡“': { attack: 42, gap: 30, total: 72 },
  'éˆ´': { attack: 134, gap: 0, total: 134, multiHit: 12, note: '12é€£æ’ƒï¼ˆ1æ’ƒã¯æ”»æ’ƒå€¤ã®1/12ï¼‰' },
  'æ–': { attack: 37, gap: 30, total: 67 },
  'ç¥“ä¸²': { attack: 32, gap: 27, total: 59 },
  'æŠ•å‰£': { attack: 24, gap: 18, total: 42 },
  'é­': { attack: 24, gap: 21, total: 45 },
  'é™£è²': { attack: 218, gap: 0, total: 218, multiHit: 18, note: '18é€£æ’ƒï¼‹ç¯„å›²å›å¾©' },
  'è»èˆ¹': { attack: 32, gap: 42, total: 74 },
};

interface WeaponFrameData {
  attack: number;   // æ”»æ’ƒãƒ•ãƒ¬ãƒ¼ãƒ 
  gap: number;      // éš™ãƒ•ãƒ¬ãƒ¼ãƒ 
  total: number;    // åˆè¨ˆãƒ•ãƒ¬ãƒ¼ãƒ 
  multiHit?: number; // é€£æ’ƒæ•°ï¼ˆéˆ´ãƒ»é™£è²ã®ã¿ï¼‰
  note?: string;    // å‚™è€ƒ
}
```

### DPSè¨ˆç®—å¼

```typescript
function calculateDPS(
  result: DamageCalculationResult,
  character: Character,
  environment: EnvironmentSettings
): number {
  const frameData = WEAPON_FRAMES[character.weaponType];
  if (!frameData) return 0;
  
  // é€Ÿåº¦ãƒãƒ•ã‚’åˆç®—ï¼ˆæœ€å¤§å€¤ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨ï¼‰
  const attackSpeedBuff = Math.max(
    character.selfBuffs.attackSpeed || 0,
    environment.attackSpeed || 0
  );
  
  const gapReductionBuff = Math.max(
    character.selfBuffs.gapReduction || 0,
    environment.gapReduction || 0
  );
  
  // ãƒ•ãƒ¬ãƒ¼ãƒ è¨ˆç®—
  // æ”»æ’ƒãƒ•ãƒ¬ãƒ¼ãƒ  = åŸºç¤æ”»æ’ƒãƒ•ãƒ¬ãƒ¼ãƒ  / (1 + æ”»æ’ƒé€Ÿåº¦%)
  const attackFrames = frameData.attack / (1 + attackSpeedBuff / 100);
  
  // éš™ãƒ•ãƒ¬ãƒ¼ãƒ  = åŸºç¤éš™ãƒ•ãƒ¬ãƒ¼ãƒ  Ã— (1 - éš™çŸ­ç¸®%)
  const gapFrames = frameData.gap * (1 - gapReductionBuff / 100);
  
  const totalFrames = attackFrames + gapFrames;
  
  // 1ç§’ã‚ãŸã‚Šã®æ”»æ’ƒå›æ•°ï¼ˆ60FPSæƒ³å®šï¼‰
  const attacksPerSecond = 60 / totalFrames;
  
  // DPSè¨ˆç®—
  // é€£æ’ƒã¯Phase 5ã§æ—¢ã«totalDamageã«å«ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ã€ãã®ã¾ã¾ä½¿ç”¨
  const dps = result.totalDamage * attacksPerSecond;
  
  return dps;
}
```

### DPSå·®åˆ†è¨ˆç®—

```typescript
interface DPSComparison {
  before: number;
  after: number;
  diff: number;
  diffPercent: number;
}

function calculateDPSComparison(
  beforeResult: DamageCalculationResult,
  afterResult: DamageCalculationResult,
  character: Character,
  beforeEnv: EnvironmentSettings,
  afterEnv: EnvironmentSettings
): DPSComparison {
  const beforeDPS = calculateDPS(beforeResult, character, beforeEnv);
  const afterDPS = calculateDPS(afterResult, character, afterEnv);
  
  return {
    before: beforeDPS,
    after: afterDPS,
    diff: afterDPS - beforeDPS,
    diffPercent: beforeDPS > 0 ? ((afterDPS - beforeDPS) / beforeDPS) * 100 : 0,
  };
}
```

---

## ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼

```typescript
interface Character {
  id: string;
  name: string;
  weaponType: string;
  level: number;
  
  // åŸºç¤ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  stats: {
    baseAttack: number;
  };
  
  // è‡ªå·±ãƒãƒ•
  selfBuffs: {
    // Phase 1: æ”»æ’ƒåŠ›ãƒãƒ•
    percentBuffs: BuffValue[];     // å‰²åˆãƒãƒ•ï¼ˆè¤‡æ•°ã‚ã‚‹å ´åˆï¼‰
    flatBuffs: number[];           // å›ºå®šå€¤ãƒãƒ•
    additiveBuffs: AdditiveValue[]; // åŠ ç®—ãƒãƒ•
    duplicateBuffs: number[];      // é‡è¤‡ãƒãƒ•
    
    // Phase 2: ãƒ€ãƒ¡ãƒ¼ã‚¸å€ç‡
    damageMultipliers: DamageMultiplier[];
    
    // Phase 3: é˜²å¾¡ç„¡è¦–
    defenseIgnore: boolean;
    
    // Phase å¤–: é€Ÿåº¦ãƒãƒ•
    attackSpeed?: number;   // æ”»æ’ƒé€Ÿåº¦%
    gapReduction?: number;  // éš™çŸ­ç¸®%
    
    // Phase å¤–: é¼“èˆ
    inspire?: {
      stat: 'attack' | 'defense';
      value: number; // %
      range: number; // å°„ç¨‹
    };
  };
  
  // é€£æ’ƒ
  multiHit?: number;
}

interface BuffValue {
  value: number;
  type: string; // ãƒãƒ•ã®ç¨®é¡è­˜åˆ¥ç”¨ï¼ˆæœ€å¤§å€¤ãƒ«ãƒ¼ãƒ«é©ç”¨ã®ãŸã‚ï¼‰
}

interface AdditiveValue {
  value: number;
  source: 'deployment' | 'tactic'; // é…ç½®ç‰¹æŠ€ or è¨ˆç•¥
}

interface DamageMultiplier {
  type: 'attack_multiple' | 'give_damage' | 'conditional';
  value: number;
  condition?: string; // æ¡ä»¶ã®èª¬æ˜
}
```

### ç’°å¢ƒè¨­å®š

```typescript
interface EnvironmentSettings {
  // å…±é€šãƒãƒ•
  inspireFlat: number;           // é¼“èˆï¼ˆå›ºå®šå€¤ï¼‰
  duplicateBuff: number;         // åŠ¹æœé‡è¤‡%
  
  // é€Ÿåº¦ãƒãƒ•
  attackSpeed: number;           // æ”»æ’ƒé€Ÿåº¦%
  gapReduction: number;          // éš™çŸ­ç¸®%
  
  // æ•µã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  enemyDefense: number;          // æ•µé˜²å¾¡åŠ›
  defenseDebuffPercent: number;  // é˜²å¾¡ãƒ‡ãƒãƒ•%
  defenseDebuffFlat: number;     // é˜²å¾¡ãƒ‡ãƒãƒ•å›ºå®šå€¤
  
  // ãƒ€ãƒ¡ãƒ¼ã‚¸ãƒãƒ•
  damageTaken: number;           // è¢«ãƒ€ãƒ¡%
  
  // æ¡ä»¶è¨­å®š
  enemyHpPercent: number;        // æ•µHP% (æ¡ä»¶ä»˜ããƒãƒ•ç”¨)
}
```

### è¨ˆç®—çµæœ

```typescript
interface DamageCalculationResult {
  characterId: string;
  
  // å„ãƒ•ã‚§ãƒ¼ã‚ºã®çµæœ
  phase1Attack: number;
  phase2Damage: number;
  phase3Damage: number;
  phase4Damage: number;
  totalDamage: number;
  
  // DPS
  dps: number;
  
  // é¼“èˆé‡ï¼ˆè©²å½“ã‚­ãƒ£ãƒ©ã®ã¿ï¼‰
  inspireAmount?: number;
  
  // è©³ç´°æƒ…å ±ï¼ˆãƒ‡ãƒãƒƒã‚°/è¡¨ç¤ºç”¨ï¼‰
  breakdown: {
    phase1: {
      baseAttack: number;
      percentBuffApplied: number;
      flatBuffApplied: number;
      additiveBuffApplied: number;
      duplicateBuffApplied: number;
      finalAttack: number;
    };
    phase2: {
      multipliers: Array<{ type: string; value: number }>;
      damage: number;
    };
    phase3: {
      enemyDefense: number;
      effectiveDefense: number;
      damage: number;
    };
    phase4: {
      damageDealt: number;
      damageTaken: number;
      damage: number;
    };
    phase5?: {
      attackCount: number;
      totalDamage: number;
    };
    dps: {
      attackFrames: number;
      gapFrames: number;
      totalFrames: number;
      attacksPerSecond: number;
      dps: number;
    };
  };
}
```

### å·®åˆ†æ¯”è¼ƒ

```typescript
interface DamageComparison {
  characterId: string;
  before: DamageCalculationResult;
  after: DamageCalculationResult;
  
  diff: {
    totalDamage: number;
    totalDamagePercent: number;
    dps: number;
    dpsPercent: number;
    inspireAmount?: number;
  };
}
```

### ç·¨æˆãƒ‡ãƒ¼ã‚¿

```typescript
interface Formation {
  id: string;
  name: string;
  characters: Character[];
  environmentSettings: EnvironmentSettings;
  createdAt: Date;
  updatedAt: Date;
}
```

---

## å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ

```
DamageCalculator/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ EnvironmentPanel.tsx          # ç’°å¢ƒè¨­å®šãƒ‘ãƒãƒ«
â”‚   â”œâ”€â”€ CharacterGrid.tsx             # ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚°ãƒªãƒƒãƒ‰ï¼ˆãƒ‰ãƒ©ãƒƒã‚°å¯¾å¿œï¼‰
â”‚   â”œâ”€â”€ CompactCharacterCard.tsx      # ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã‚«ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ DetailPanel.tsx               # è©³ç´°ãƒ‘ãƒãƒ«
â”‚   â”œâ”€â”€ DiffIndicator.tsx             # å·®åˆ†è¡¨ç¤º
â”‚   â””â”€â”€ FormationManager.tsx          # ç·¨æˆç®¡ç†
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useDamageCalculation.ts       # ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”œâ”€â”€ useDPSCalculation.ts          # DPSè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â””â”€â”€ useEnvironmentSettings.ts     # ç’°å¢ƒè¨­å®šç®¡ç†
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ damageCalculator.ts           # Phase 1-5ã®è¨ˆç®—
â”‚   â”œâ”€â”€ dpsCalculator.ts              # DPSè¨ˆç®—
â”‚   â”œâ”€â”€ formatters.ts                 # æ•°å€¤ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
â”‚   â””â”€â”€ constants.ts                  # å®šæ•°ï¼ˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ãªã©ï¼‰
â””â”€â”€ types/
    â””â”€â”€ index.ts                      # å‹å®šç¾©
```

### è¨ˆç®—ãƒ•ãƒ­ãƒ¼ã®å®Ÿè£…

```typescript
// ãƒ¡ã‚¤ãƒ³ã®è¨ˆç®—ãƒ•ãƒƒã‚¯
function useDamageCalculation(
  characters: Character[],
  environment: EnvironmentSettings
) {
  const [results, setResults] = useState<Record<string, DamageCalculationResult>>({});
  const [comparisons, setComparisons] = useState<Record<string, DamageComparison>>({});
  const [previousEnvironment, setPreviousEnvironment] = useState(environment);

  useEffect(() => {
    // å…¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’è¨ˆç®—
    const newResults: Record<string, DamageCalculationResult> = {};
    
    for (const character of characters) {
      newResults[character.id] = calculateDamage(character, environment);
    }
    
    setResults(newResults);
    
    // å·®åˆ†ã‚’è¨ˆç®—
    if (previousEnvironment) {
      const newComparisons: Record<string, DamageComparison> = {};
      
      for (const character of characters) {
        const beforeResult = calculateDamage(character, previousEnvironment);
        const afterResult = newResults[character.id];
        
        newComparisons[character.id] = {
          characterId: character.id,
          before: beforeResult,
          after: afterResult,
          diff: {
            totalDamage: afterResult.totalDamage - beforeResult.totalDamage,
            totalDamagePercent: ((afterResult.totalDamage - beforeResult.totalDamage) / beforeResult.totalDamage) * 100,
            dps: afterResult.dps - beforeResult.dps,
            dpsPercent: ((afterResult.dps - beforeResult.dps) / beforeResult.dps) * 100,
          },
        };
      }
      
      setComparisons(newComparisons);
    }
    
    setPreviousEnvironment(environment);
  }, [characters, environment]);

  return { results, comparisons };
}
```

### ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°

```typescript
// æ•°å€¤ã‚’çŸ­ç¸®è¡¨ç¤ºï¼ˆ15234 â†’ 15.2Kï¼‰
function formatCompactNumber(num: number): string {
  if (num >= 1000000) {
    return `${(num / 1000000).toFixed(1)}M`;
  }
  if (num >= 1000) {
    return `${(num / 1000).toFixed(1)}K`;
  }
  return num.toString();
}

// åå‰ã‚’çŸ­ç¸®ï¼ˆã€Œçµ¢çˆ›ãƒ€ãƒã‚¿ãƒ¼åŸã€â†’ã€Œçµ¢çˆ›ãƒ€ãƒã€ï¼‰
function truncateName(name: string, maxLength: number): string {
  if (name.length <= maxLength) return name;
  return name.slice(0, maxLength);
}

// å·®åˆ†ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼
function DiffIndicator({ value, percent }: { value: number; percent: number }) {
  if (Math.abs(percent) < 0.1) {
    return <span className="diff-indicator neutral">-</span>;
  }
  
  const isPositive = percent > 0;
  const className = `diff-indicator ${isPositive ? 'positive' : 'negative'}`;
  
  return (
    <span className={className}>
      {isPositive ? 'â†‘' : 'â†“'} {Math.abs(percent).toFixed(1)}%
    </span>
  );
}
```

### é‡è¦ãªè¨ˆç®—ãƒ«ãƒ¼ãƒ«ã®å®Ÿè£…

```typescript
// æœ€å¤§å€¤ãƒ«ãƒ¼ãƒ«ã®é©ç”¨
function applyMaxValueRule(buffs: BuffValue[]): number {
  if (buffs.length === 0) return 0;
  
  // åŒç¨®ãƒãƒ•ã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
  const grouped = buffs.reduce((acc, buff) => {
    if (!acc[buff.type]) {
      acc[buff.type] = [];
    }
    acc[buff.type].push(buff.value);
    return acc;
  }, {} as Record<string, number[]>);
  
  // å„ã‚°ãƒ«ãƒ¼ãƒ—ã®æœ€å¤§å€¤ã‚’å–å¾—ã—ã¦åˆè¨ˆ
  return Object.values(grouped)
    .map(values => Math.max(...values))
    .reduce((sum, max) => sum + max, 0);
}

// åŠ ç®—ãƒãƒ•ã¨é‡è¤‡ãƒãƒ•ã®ç‰¹æ®Šç›¸äº’ä½œç”¨
function applyAdditiveWithDuplicate(
  baseAttack: number,
  additiveBuffs: AdditiveValue[],
  duplicateBuff: number
): number {
  const totalAdditive = additiveBuffs.reduce((sum, buff) => {
    const baseValue = baseAttack * (buff.value / 100);
    // å°„ç¨‹å†…é‡è¤‡ãƒãƒ•ãŒã‚ã‚‹å ´åˆã€åŠ ç®—ãƒãƒ•ã‚‚ä¹—ç®—ã•ã‚Œã‚‹
    return sum + (baseValue * (1 + duplicateBuff / 100));
  }, 0);
  
  return totalAdditive;
}
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

```typescript
// ãƒ¡ãƒ¢åŒ–ã•ã‚ŒãŸè¨ˆç®—
const memoizedCalculateDamage = useMemo(() => {
  return (character: Character, environment: EnvironmentSettings) => {
    return calculateDamage(character, environment);
  };
}, []);

// ãƒ‡ãƒã‚¦ãƒ³ã‚¹å‡¦ç†ï¼ˆç’°å¢ƒè¨­å®šã®å¤‰æ›´æ™‚ï¼‰
const debouncedUpdateEnvironment = useMemo(
  () => debounce((newSettings: EnvironmentSettings) => {
    setEnvironment(newSettings);
  }, 300),
  []
);
```

---

## å¤‰æ›´å±¥æ­´

### v1.0 (2025-12-07)
- åˆç‰ˆä½œæˆ
- ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—ä»•æ§˜ã®å®Œå…¨å®šç¾©
- UIè¨­è¨ˆï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã‚«ãƒ¼ãƒ‰ã€6åˆ—ã‚°ãƒªãƒƒãƒ‰ï¼‰
- DPSè¨ˆç®—ï¼ˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã€é€Ÿåº¦ãƒãƒ•å¯¾å¿œï¼‰
- ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½
- ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å®šç¾©

---

*Last Updated: 2025-12-07*  
*Version: 1.0*  
*Document Status: Complete*
