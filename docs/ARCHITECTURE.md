# ShiroPro Tools (Reborn) - çµ±åˆè¨­è¨ˆæ›¸

**Version**: 2.0  
**Last Updated**: 2025-12-07

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“åƒ

### 1.1 ç›®çš„
åŸãƒ—ãƒ­REã®ç·¨æˆç®¡ç†ã€ãƒãƒ•å¯è¦–åŒ–ã€ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—ã‚’è¡Œã†Webã‚¢ãƒ—ãƒªã€‚
æ—§ãƒ„ãƒ¼ãƒ«ï¼ˆbuffParser.jsï¼‰ã®è³‡ç”£ã‚’æ´»ã‹ã—ã¤ã¤ã€TypeScript + React ã§å …ç‰¢ã«å†æ§‹ç¯‰ã€‚

### 1.2 ã‚³ã‚¢åŸå‰‡
1. **Core/UIåˆ†é›¢**: è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã¯Reactéä¾å­˜ã®ç´”ç²‹é–¢æ•°
2. **å‹å®‰å…¨**: ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã«TypeScriptå‹å®šç¾©
3. **ãƒ†ã‚¹ã‚¿ãƒ–ãƒ«**: Vitestã§ãƒ­ã‚¸ãƒƒã‚¯ã‚’å¾¹åº•ãƒ†ã‚¹ãƒˆ
4. **æ®µéšçš„ç§»æ¤**: æ—§ãƒ„ãƒ¼ãƒ«ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å°‘ã—ãšã¤ç§»æ¤
5. **å®Ÿç”¨æ€§é‡è¦–**: å®Ÿéš›ã®ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ã«åŸºã¥ã„ãŸè¨­è¨ˆ

---

## 2. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«è¨­è¨ˆ

### 2.1 Reborn å‹å®šç¾©ï¼ˆå®Œå…¨ç‰ˆï¼‰

#### Statï¼ˆãƒãƒ•ç¨®åˆ¥ï¼‰

ãƒãƒ•ã®ç¨®åˆ¥ã‚’ç›®çš„åˆ¥ã«4ã¤ã®ã‚«ãƒ†ã‚´ãƒªã«åˆ†é¡ã—ã¾ã™ã€‚ã“ã®åˆ†é¡ã«ã‚ˆã‚Šã€ã‚³ãƒ¼ãƒ‰ã®è¦‹é€šã—ãŒè‰¯ããªã‚Šã€è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã®è²¬å‹™ãŒæ˜ç¢ºã«ãªã‚Šã¾ã™ã€‚

```typescript
// ========================================
// å‘³æ–¹ãƒãƒ•ç³»ï¼ˆç·¨æˆãƒ‘ã‚ºãƒ«ï¼‹ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—ï¼‰
// ========================================
type AllyBuffStat =
  | 'attack'              // æ”»æ’ƒåŠ›
  | 'defense'             // é˜²å¾¡åŠ›
  | 'range'               // å°„ç¨‹
  | 'attack_speed'        // æ”»æ’ƒé€Ÿåº¦ï¼ˆæ—§ç‰ˆã®ã€Œé€Ÿåº¦ã€ï¼‰
  | 'attack_gap'          // æ”»æ’ƒéš™ï¼ˆæ—§ç‰ˆã®ã€Œéš™ã€ï¼‰
  | 'recovery'            // å›å¾©åŠ›
  | 'cost'                // è‡ªç„¶æ°—ï¼ˆ40%/70%ï¼‰
  | 'cost_gradual'        // å¾ã€…æ°—ï¼ˆæ™‚é–“çµŒéã§å¢—åŠ ï¼‰
  | 'cost_giant'          // æ°—è»½æ¸›ï¼ˆå·¨å¤§åŒ–æ¶ˆè²»æ°—è»½æ¸›ï¼‰
  | 'cost_strategy'       // è¨ˆç•¥æ¶ˆè²»æ°—è»½æ¸›
  | 'cost_enemy_defeat'   // æ°—ç‰›ï¼ˆæ•µã‚’å€’ã™ã¨æ°—å¢—åŠ ï¼‰
  | 'cost_defeat_bonus'   // æ°—ãƒãƒ“ï¼ˆæ’ƒç ´æ™‚ã®ç²å¾—æ°—å¢—åŠ ï¼‰
  | 'strategy_cooldown'   // è¨ˆç•¥å†ä½¿ç”¨æ™‚é–“
  | 'target_count'        // æ”»æ’ƒå¯¾è±¡æ•°
  | 'attack_count';       // æ”»æ’ƒå›æ•°

// ========================================
// ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—å°‚ç”¨ãƒãƒ•ï¼ˆä¹—ç®—ç³»ï¼‰
// ========================================
type DamageMultiplierStat =
  | 'damage_dealt'        // ä¸ãƒ€ãƒ¡
  | 'give_damage'         // ä¸ãˆã‚‹ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼ˆåˆ¥è¨ˆç®—å¼ï¼‰
  | 'damage_taken'        // è¢«ãƒ€ãƒ¡ï¼ˆæ•µå´ï¼‰
  | 'damage_recovery'     // ä¸ãƒ€ãƒ¡å›å¾©
  | 'critical_bonus';     // ç›´æ’ƒãƒœãƒ¼ãƒŠã‚¹

// ========================================
// æ•µãƒ‡ãƒãƒ•ç³»ï¼ˆãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—å°‚ç”¨ï¼‰
// ========================================
type EnemyDebuffStat =
  | 'enemy_attack'                      // æ•µã®æ”»æ’ƒåŠ›ä½ä¸‹
  | 'enemy_defense'                     // æ•µã®é˜²å¾¡åŠ›ä½ä¸‹
  | 'enemy_defense_ignore_percent'      // å‰²åˆé˜²å¾¡ç„¡è¦–ï¼ˆâ—‹%ï¼‰
  | 'enemy_defense_ignore_complete'     // å®Œå…¨é˜²å¾¡ç„¡è¦–
  | 'enemy_movement'                    // æ•µã®ç§»å‹•é€Ÿåº¦ä½ä¸‹
  | 'enemy_retreat'                     // æ•µå¾Œé€€ï¼ˆãƒã‚¹æ•°ï¼‰
  | 'enemy_range'                       // æ•µã®å°„ç¨‹ä½ä¸‹
  | 'enemy_damage_dealt'                // æ•µã®ä¸ãƒ€ãƒ¡ä½ä¸‹ï¼ˆé˜²å¾¡è²¢çŒ®ï¼‰
  | 'enemy_damage_taken';               // æ•µã®è¢«ãƒ€ãƒ¡ä¸Šæ˜‡ï¼ˆæ”»æ’ƒè²¢çŒ®ï¼‰

// ========================================
// ç‰¹æ®Šãƒãƒ•ç³»
// ========================================
type SpecialBuffStat =
  | 'inspire';            // é¼“èˆï¼ˆå°‚ç”¨è¨ˆç®—ï¼‰

// ========================================
// Wikiãƒ‘ãƒ¼ã‚¹ç”¨ãƒ¬ã‚¬ã‚·ãƒ¼å‹ï¼ˆbaseStatsæ ¼ç´ç”¨ï¼‰
// ========================================
type LegacyStat =
  | 'hp'                  // è€ä¹…
  | 'cooldown'            // ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³
  | 'movement_speed'      // ç§»å‹•é€Ÿåº¦
  | 'knockback'           // ãƒãƒƒã‚¯ãƒãƒƒã‚¯
  | 'ki_gain'             // æ°—ç²å¾—
  | 'damage_drain'        // ãƒ€ãƒ¡ãƒ¼ã‚¸å¸å
  | 'ignore_defense';     // é˜²å¾¡ç„¡è¦–

type Stat = AllyBuffStat | DamageMultiplierStat | EnemyDebuffStat | SpecialBuffStat | LegacyStat;
```

#### BuffModeï¼ˆé©ç”¨æ–¹å¼ï¼‰

```typescript
type BuffMode =
  | 'percent_max'        // å‰²åˆãƒãƒ•ï¼ˆ+30%ï¼‰
  | 'flat_sum'           // å›ºå®šå€¤åŠ ç®—ï¼ˆ+50ï¼‰
  | 'percent_reduction'  // å‰²åˆæ¸›å°‘ï¼ˆéš™çŸ­ç¸®30%, æ°—è»½æ¸›20%ç­‰ï¼‰
  | 'absolute_set';      // çµ¶å¯¾å€¤è¨­å®šï¼ˆç›´æ’ƒãƒœãƒ¼ãƒŠã‚¹ãŒâ—‹%ã«ä¸Šæ˜‡ï¼‰
```

#### Targetï¼ˆãƒãƒ•ã®ç¯„å›²ï¼‰

**é‡è¦ãªè¨­è¨ˆåŸå‰‡**: targetã¯ã€Œç¯„å›²ã€ã‚’è¡¨ã—ã€ConditionTagã¯ã€Œãã®ç¯„å›²å†…ã§ã®çµã‚Šè¾¼ã¿ã€ã‚’è¡¨ã—ã¾ã™ã€‚

```typescript
type Target = 
  | 'self'           // è‡ªåˆ†è‡ªèº«
  | 'ally'           // å¯¾è±¡æŒ‡å®šï¼ˆ1ä½“ï¼‰
  | 'range'          // å°„ç¨‹å†…
  | 'all'            // å…¨ä½“
  | 'field'          // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å…¨ä½“ï¼ˆæ°—ãªã©ï¼‰
  | 'out_of_range';  // å°„ç¨‹å¤–
```

**å„Targetã®èª¬æ˜**:

| Target | æ„å‘³ | ä¾‹ | å‚™è€ƒ |
|--------|------|-----|------|
| `self` | è‡ªåˆ†è‡ªèº« | ã€Œè‡ªèº«ã®æ”»æ’ƒãŒ30%ä¸Šæ˜‡ã€ | æœ€ã‚‚åŸºæœ¬çš„ãªãƒãƒ• |
| `ally` | å¯¾è±¡æŒ‡å®šï¼ˆ1ä½“ï¼‰ | ã€Œå¯¾è±¡ã®æ”»æ’ƒãŒ50%ä¸Šæ˜‡ã€ | è¨ˆç•¥ã§ç‰¹å®šã®å‘³æ–¹ã‚’é¸æŠ |
| `range` | å°„ç¨‹å†… | ã€Œå°„ç¨‹å†…ã®å‘³æ–¹ã®æ”»æ’ƒãŒ20%ä¸Šæ˜‡ã€ | æœ€ã‚‚ä¸€èˆ¬çš„ãªç¯„å›²ãƒãƒ• |
| `all` | å…¨ä½“ | ã€Œå…¨ã¦ã®åŸå¨˜ã®æ”»æ’ƒãŒ15%ä¸Šæ˜‡ã€ | ç·¨æˆç‰¹æŠ€ã‚„ä¸€éƒ¨ã®æˆ¦ç•¥ |
| `field` | ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å…¨ä½“ | ã€Œè‡ªç„¶ã«æ°—ãŒ5å¢—åŠ ã€ | æ°—ãªã©ã€å€‹åˆ¥ã‚­ãƒ£ãƒ©ã§ã¯ãªãç·¨æˆå…¨ä½“ã®ãƒªã‚½ãƒ¼ã‚¹ |
| `out_of_range` | å°„ç¨‹å¤– | ã€Œå°„ç¨‹å¤–ã®å‘³æ–¹ã®é˜²å¾¡ãŒ30%ä¸Šæ˜‡ã€ | ç”²åºœåŸã®ã‚ˆã†ãªç‰¹æ®Šãƒãƒ• |

**ConditionTagã¨ã®çµ„ã¿åˆã‚ã›ä¾‹**:

```typescript
// å°„ç¨‹å†…ã®è¿‘æ¥åŸå¨˜ã®æ”»æ’ƒãŒ50%ä¸Šæ˜‡
{
  stat: 'attack',
  target: 'range',           // ç¯„å›²ï¼šå°„ç¨‹å†…
  conditionTags: ['melee'],  // çµã‚Šè¾¼ã¿ï¼šè¿‘æ¥ã®ã¿
  value: 50
}

// å…¨ã¦ã®æ°´å±æ€§åŸå¨˜ã®é˜²å¾¡ãŒ30%ä¸Šæ˜‡
{
  stat: 'defense',
  target: 'all',             // ç¯„å›²ï¼šå…¨ä½“
  conditionTags: ['water'],  // çµã‚Šè¾¼ã¿ï¼šæ°´å±æ€§ã®ã¿
  value: 30
}
```

#### ã‚µãƒ–ã‚¿ã‚¤ãƒ—å®šç¾©

æ°—ãƒãƒ•ã¯ç²å¾—æ–¹æ³•ã‚„ç”¨é€”ã«ã‚ˆã£ã¦ç´°ã‹ãåˆ†é¡ã•ã‚Œã¾ã™ã€‚

```typescript
type CostBuffType = 
  | 'natural'        // è‡ªç„¶å›å¾©ï¼ˆç§’é–“â—‹å¢—åŠ ï¼‰
  | 'enemy_defeat'   // æ•µæ’ƒç ´æ™‚ï¼ˆç‰›ï¼‰
  | 'ally_defeat'    // åŸå¨˜æ’ƒç ´æ™‚ï¼ˆãƒãƒ“ï¼‰
  | 'gradual'        // å¾ã€…ã«å¢—åŠ 
  | 'strategy_use'   // è¨ˆç•¥ä½¿ç”¨æ™‚
  | 'strategy_cost'  // è¨ˆç•¥æ¶ˆè²»æ°—æ¸›å°‘ï¼ˆâ€»å›ºå®šå€¤ãŒå¤šã„ï¼‰
  | 'giant_cost';    // å·¨å¤§åŒ–æ°—è»½æ¸›

type DynamicBuffType = 
  | 'per_enemy_in_range'      // å°„ç¨‹å†…æ•µ1ä½“æ¯
  | 'per_ally_in_range'       // å°„ç¨‹å†…å‘³æ–¹1ä½“æ¯
  | 'per_ally_other'          // å‘³æ–¹1ä½“æ¯ï¼ˆè‡ªèº«é™¤ãï¼‰
  | 'per_ambush_deployed'     // é…ç½®ã•ã‚ŒãŸä¼å…µ1ä½“æ¯
  | 'per_enemy_defeated'      // æ’ƒç ´ã—ãŸæ•µ1ä½“æ¯
  | 'per_specific_attribute'  // ç‰¹å®šå±æ€§ã®åŸå¨˜1ä½“æ¯
  | 'per_specific_weapon';    // ç‰¹å®šæ­¦å™¨ç¨®ã®åŸå¨˜1ä½“æ¯
```

#### Buff ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆå®Œå…¨ç‰ˆï¼‰

```typescript
interface Buff {
  id: string;
  stat: Stat;
  mode: BuffMode;
  value: number;
  source: 'self_skill' | 'ally_skill' | 'strategy' | 'formation_skill';
  target: Target;
  conditionTags?: ConditionTag[];
  isActive: boolean;
  
  // åŠ¹æœé‡è¤‡é–¢é€£ãƒ•ãƒ©ã‚°
  isDuplicate?: boolean;              // åŠ¹æœé‡è¤‡ï¼ˆåˆ¥é€”è¨ˆç®—ã•ã‚Œã‚‹ï¼‰
  isExplicitlyNonDuplicate?: boolean; // æ˜ç¤ºçš„ãªé‡è¤‡ä¸å¯ï¼ˆã€ŒåŒç¨®åŠ¹æœã®é‡è¤‡ç„¡ã—ã€ç­‰ï¼‰
  nonStacking?: boolean;              // é‡è¤‡ãªã—ï¼ˆæœ€å¤§å€¤ã®ã¿é©ç”¨ï¼‰
  stackPenalty?: number;              // é‡è¤‡æ™‚åŠ¹æœæ¸›å°‘ï¼ˆ0-100ã®æ¸›å°‘ç‡ï¼‰
  stackable?: boolean;                // ã‚¹ã‚¿ãƒƒã‚¯å¯èƒ½ï¼ˆæ•µæ’ƒç ´æ¯ã«ç­‰ï¼‰
  maxStacks?: number;                 // æœ€å¤§ã‚¹ã‚¿ãƒƒã‚¯æ•°
  currentStacks?: number;             // ç¾åœ¨ã®ã‚¹ã‚¿ãƒƒã‚¯æ•°ï¼ˆå®Ÿè¡Œæ™‚ã«ä½¿ç”¨ï¼‰

  // å„ªå…ˆåº¦ï¼ˆåŒä¸€statã§è¤‡æ•°BuffãŒã‚ã‚‹å ´åˆã®é¸æŠåŸºæº–ï¼‰
  priority?: 'low' | 'normal' | 'high';
  
  // å‹•çš„ãƒãƒ•é–¢é€£
  isDynamic?: boolean;
  dynamicType?: DynamicBuffType;
  dynamicCategory?: 'formation' | 'combat_situation';
  unitValue?: number;                // å˜ä½ã‚ãŸã‚Šã®åŠ¹æœå€¤
  dynamicParameter?: string;         // å‹•çš„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®èª¬æ˜
  
  // ä¼å…µä¾å­˜ãƒ•ãƒ©ã‚°
  requiresAmbush?: boolean;   // ä¼å…µãŒé…ç½®ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹ãƒãƒ•
  
  // costå°‚ç”¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  costType?: CostBuffType;
  
  // inspireå°‚ç”¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  inspireSourceStat?: Stat;   // å‚ç…§å…ƒï¼ˆ'attack', 'defense'ç­‰ï¼‰
  
  // æ‰‹å‹•ç·¨é›†ã‚µãƒãƒ¼ãƒˆ
  confidence?: 'certain' | 'inferred' | 'uncertain';
  inferenceReason?: string;
  
  // è£œè¶³æƒ…å ±
  note?: string;              // åŠ¹æœæ™‚é–“ã€ç¯„å›²ã‚µã‚¤ã‚ºãªã©ã®è¿½åŠ æƒ…å ±
}
```

### 2.2 æ—§ãƒ„ãƒ¼ãƒ«ï¼ˆbuffParser.jsï¼‰ã®å‡ºåŠ›å½¢å¼

æ—§buffParser.jsã¯ä»¥ä¸‹ã®å½¢å¼ã§ãƒãƒ•æƒ…å ±ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚

```javascript
// parseSkillLine ã®å‡ºåŠ›ä¾‹
{
  type: 'æ”»æ’ƒå‰²åˆ',      // â†’ Stat ã¸å¤‰æ›
  target: 'è‡ªèº«',        // â†’ target ã¸å¤‰æ›
  value: 30,
  unit: '+%',           // â†’ BuffMode ã¸å¤‰æ›
  isSpecial: false,
  hasCondition: false,
  note: ''
}
```

### 2.3 å‹å¤‰æ›ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆè¦ç´„ç‰ˆï¼‰

è©³ç´°ãªãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ `TYPE_CONVERSION_MAPPING.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ã“ã“ã§ã¯ä¸»è¦ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã¿è¨˜è¼‰ã—ã¾ã™ã€‚

#### æ”»æ’ƒãƒ»é˜²å¾¡ç³»

| æ—§type | æ—§unit | â†’ Reborn Stat | â†’ BuffMode | å‚™è€ƒ |
|--------|--------|---------------|------------|------|
| æ”»æ’ƒå‰²åˆ | `+%` | `attack` | `percent_max` | |
| æ”»æ’ƒå‰²åˆ | `Ã—` | `attack` | `percent_max` | å€ç‡â†’%å¤‰æ› |
| æ”»æ’ƒå›ºå®š | `+` | `attack` | `flat_sum` | |
| é˜²å¾¡å‰²åˆ | `+%` | `defense` | `percent_max` | |
| é˜²å¾¡å›ºå®š | `+` | `defense` | `flat_sum` | |
| æ”»æ’ƒãƒ‡ãƒãƒ•å‰²åˆ | `+%` | `enemy_attack` | `percent_max` | |
| é˜²å¾¡ãƒ‡ãƒãƒ•å‰²åˆ | `+%` | `enemy_defense` | `percent_max` | |
| é˜²å¾¡ç„¡è¦– | - | `enemy_defense_ignore_complete` | `flat_sum` | value=1 |
| é˜²å¾¡ç„¡è¦–ï¼ˆå‰²åˆï¼‰ | `%` | `enemy_defense_ignore_percent` | `percent_max` | |

#### ãƒ€ãƒ¡ãƒ¼ã‚¸ç³»

| æ—§type | æ—§unit | â†’ Reborn Stat | â†’ BuffMode | å‚™è€ƒ |
|--------|--------|---------------|------------|------|
| ä¸ãƒ€ãƒ¡ | `+%/Ã—` | `damage_dealt` | `percent_max` | |
| ä¸ãˆã‚‹ãƒ€ãƒ¡ãƒ¼ã‚¸ | `+%/Ã—` | `give_damage` | `percent_max` | å®Œå…¨ä¸€è‡´ã®ã¿ |
| è¢«ãƒ€ãƒ¡ | `Â±%` | `damage_taken` | `percent_max` | |
| ä¸ãƒ€ãƒ¡å›å¾© | `+%` | `damage_recovery` | `percent_max` | |

#### é€Ÿåº¦ãƒ»éš™ç³»ï¼ˆåˆ†é›¢ï¼‰

| æ—§type | æ—§unit | â†’ Reborn Stat | â†’ BuffMode | å‚™è€ƒ |
|--------|--------|---------------|------------|------|
| é€Ÿåº¦ | `Â±%` | `attack_speed` | `percent_max` | |
| éš™ | `+%` | `attack_gap` | `percent_reduction` | çŸ­ç¸® |
| éš™ | `-%` | `attack_gap` | `percent_max` | å¢—åŠ  |

#### æ°—ãƒ»è¨ˆç•¥ç³»

**æ³¨æ„**: æ°—ãƒãƒ•ã¯ç¨®é¡ã”ã¨ã«å°‚ç”¨ã®Statã‚’ä½¿ç”¨ã—ã¾ã™ï¼ˆv2.1ã§å¤‰æ›´ï¼‰

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | â†’ Reborn Stat | BuffMode | å‚™è€ƒ |
|---------|---------------|----------|------|
| è‡ªç„¶ã«æ°—ãŒå¢—åŠ  | `cost` | `percent_max` | 40%ï¼ˆå¢—åŠ ï¼‰/70%ï¼ˆå¤§ããå¢—åŠ ï¼‰ |
| å¾ã€…ã«æ°—ãŒNå¢—åŠ  | `cost_gradual` | `flat_sum` | æ™‚é–“çµŒéãƒ»å·¨å¤§åŒ–æ¯ãªã© |
| æ•µæ’ƒç ´æ™‚ã®ç²å¾—æ°— | `cost_enemy_defeat` | `flat_sum` | æ°—(ç‰›) - ãƒ†ã‚­ã‚¹ãƒˆã«ã€Œæ•µã€å«ã‚€ |
| æ’ƒç ´ç²å¾—æ°—Nå¢—åŠ  | `cost_defeat_bonus` | `flat_sum` | æ°—(ãƒãƒ“) - ãƒ†ã‚­ã‚¹ãƒˆã«ã€Œæ•µã€å«ã¾ãªã„ |
| å·¨å¤§åŒ–æ°—N%è»½æ¸› | `cost_giant` | `percent_reduction` | %è»½æ¸›ã¯å·¨å¤§åŒ–æ°—ã®ã¿å¯¾è±¡ |
| æ¶ˆè²»æ°—ãŒNè»½æ¸› | `cost_giant` | `flat_sum` | å›ºå®šå€¤ã¯ä¸¡æ–¹å¯¾è±¡ |
| è¨ˆç•¥æ¶ˆè²»æ°— | `cost_strategy` | `flat_sum` | |
| è¨ˆç•¥çŸ­ç¸® | `strategy_cooldown` | `percent_reduction` | |

#### ãã®ä»–

| æ—§type | æ—§unit | â†’ Reborn Stat | â†’ BuffMode | å‚™è€ƒ |
|--------|--------|---------------|------------|------|
| å°„ç¨‹å‰²åˆ | `Â±%` | `range` | `percent_max` | |
| å°„ç¨‹å›ºå®š | `Â±` | `range` | `flat_sum` | |
| å¯¾è±¡æ•° | `Â±` | `target_count` | `flat_sum` | |
| æ”»æ’ƒå›æ•° | `+` | `attack_count` | `flat_sum` | |
| å›å¾© | `+` | `recovery` | `flat_sum` | |
| å›å¾©å‰²åˆ | `Ã—` | `recovery` | `percent_max` | å€ç‡å¤‰æ› |
| ç§»å‹•ä½ä¸‹ | `-%` | `enemy_movement` | `percent_max` | |
| ç§»å‹•å¾Œé€€ | `+` | `enemy_knockback` | `flat_sum` | ãƒã‚¹æ•° |

---

## 3. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 3.1 ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
src/
â”œâ”€â”€ core/                      # ãƒ”ãƒ¥ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆReactéä¾å­˜ï¼‰
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ index.ts           # å‹å®šç¾©ï¼ˆå®Œå…¨ç‰ˆï¼‰
â”‚   â”œâ”€â”€ parser/
â”‚   â”‚   â”œâ”€â”€ buffParser.ts      # æ—§buffParser.jsã®TSç§»æ¤
â”‚   â”‚   â”œâ”€â”€ patterns.ts        # æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³å®šç¾©
â”‚   â”‚   â”œâ”€â”€ converter.ts       # æ—§å½¢å¼â†’Rebornå½¢å¼å¤‰æ›
â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚       â””â”€â”€ buffParser.test.ts
â”‚   â”œâ”€â”€ logic/
â”‚   â”‚   â”œâ”€â”€ buffs.ts           # ãƒãƒ•è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ damageCalculator.ts # ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—
â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚       â”œâ”€â”€ buffs.test.ts
â”‚   â”‚       â””â”€â”€ damageCalculator.test.ts
â”‚   â”œâ”€â”€ wiki/                  # Wikiãƒ‘ãƒ¼ã‚¹æ©Ÿèƒ½
â”‚   â”‚   â”œâ”€â”€ fetcher.ts         # HTMLå–å¾—
â”‚   â”‚   â”œâ”€â”€ parser.ts          # HTMLâ†’RawData
â”‚   â”‚   â”œâ”€â”€ analyzer.ts        # RawDataâ†’Character
â”‚   â”‚   â””â”€â”€ types.ts           # Wikié–¢é€£å‹å®šç¾©
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”œâ”€â”€ weaponMapping.ts   # æ­¦å™¨ç¨®ãƒãƒƒãƒ”ãƒ³ã‚°
â”‚   â”‚   â””â”€â”€ weaponFrames.ts    # æ­¦å™¨ç¨®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ conditions.ts          # æ¡ä»¶ã‚¿ã‚°åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
â”‚   â””â”€â”€ mock/
â”‚       â””â”€â”€ data.ts            # ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿

â”œâ”€â”€ ui/                        # Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ FormationGrid.tsx
â”‚   â”‚   â”œâ”€â”€ BuffMatrix.tsx
â”‚   â”‚   â”œâ”€â”€ BuffStackBar.tsx
â”‚   â”‚   â”œâ”€â”€ WikiImporter.tsx   # Wikiå–ã‚Šè¾¼ã¿ãƒ¢ãƒ¼ãƒ€ãƒ«
â”‚   â”‚   â”œâ”€â”€ WikiImport.tsx     # Wikiå–ã‚Šè¾¼ã¿UI
â”‚   â”‚   â””â”€â”€ AttackerAnalysisModal.tsx
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ useFormation.ts
â”‚   â””â”€â”€ contexts/
â”‚       â””â”€â”€ FormationContext.tsx

â”œâ”€â”€ App.tsx
â””â”€â”€ main.tsx
```

### 3.2 ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
[Wiki URL]
    â†“
[Fetcher] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“ HTML                                              â”‚
[Wiki Parser] (parseWikiHTML)                          â”‚
    â†“ RawData { skillsText, strategiesText }           â”‚
[Buff Parser] (parseSkillLine) â† æ—§buffParserç§»æ¤       â”‚
    â†“ ParsedBuff[]                                      â”‚
[Converter] (convertToRebornBuff)                      â”‚
    â†“ Buff[]                                            â”‚
[Character Builder]                                    â”‚
    â†“ Character                                         â”‚
[Formation State] â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
[calcBuffMatrix] (ãƒ”ãƒ¥ã‚¢é–¢æ•°)
    â†“ BuffMatrixResult
[React Components] â†’ è¡¨ç¤º
```

---

## 4. ç§»æ¤è¨ˆç”»

### Phase 1: buffParserã®ç§»æ¤ï¼ˆå„ªå…ˆåº¦ï¼šæœ€é«˜ï¼‰

#### 4.1 ç§»æ¤å¯¾è±¡ï¼ˆbuffParser.js ã‚ˆã‚Šï¼‰

1. **æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³** (~50å€‹)
   - æ”»æ’ƒãƒãƒ•ã€é˜²å¾¡ãƒãƒ•ã€å°„ç¨‹ãƒãƒ•...
   - æ¡ä»¶ä»˜ããƒãƒ•ï¼ˆå·¨å¤§åŒ–æ™‚ã€ã€‡ã€‡å±æ€§ã®åŸå¨˜...ï¼‰

2. **parseSkillLine é–¢æ•°**
   - ç‰¹æŠ€ãƒ†ã‚­ã‚¹ãƒˆ â†’ ParsedBuff[] ã¸ã®å¤‰æ›

3. **weaponMapping**
   - æ­¦å™¨ç¨® â†’ { range, type, placement }

4. **targetMapping / legacyTargetMapping**
   - ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¡¨è¨˜ã®æ­£è¦åŒ–

#### 4.2 ç§»æ¤æ‰‹é †

```
Step 1: types/index.ts
  - å®Œå…¨ãªå‹å®šç¾©ã‚’ä½œæˆ
  - Stat, BuffMode, Buff ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©
  - ã‚µãƒ–ã‚¿ã‚¤ãƒ—ï¼ˆCostBuffTypeç­‰ï¼‰ã‚’å®šç¾©

Step 2: patterns.ts
  - æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’TypeScriptã§å®šç¾©
  - ãƒ‘ã‚¿ãƒ¼ãƒ³ã”ã¨ã«å¯¾å¿œã™ã‚‹Stat/BuffModeã‚’æ˜è¨˜

Step 3: buffParser.ts
  - parseSkillLine ã‚’ç§»æ¤
  - æˆ»ã‚Šå€¤å‹ã‚’ ParsedBuff ã¨ã—ã¦å®šç¾©

Step 4: converter.ts
  - ParsedBuff â†’ Buff ã¸ã®å¤‰æ›é–¢æ•°
  - æ—§è¡¨è¨˜â†’æ–°è¡¨è¨˜ã®ãƒãƒƒãƒ”ãƒ³ã‚°
  - å€ç‡â†’%å¤‰æ›ã€åŠ¹æœé‡è¤‡æ¤œå‡ºã€é¼“èˆå‡¦ç†ç­‰

Step 5: ãƒ†ã‚¹ãƒˆä½œæˆ
  - æ—¢çŸ¥ã®ç‰¹æŠ€ãƒ†ã‚­ã‚¹ãƒˆã§æœŸå¾…å€¤ã‚’ç¢ºèª
  - ã€Œæ”»æ’ƒãŒ30%ä¸Šæ˜‡ã€â†’ { stat: 'attack', value: 30, mode: 'percent_max' }
  - ã€Œè‡ªèº«ã®æ”»æ’ƒã®30%ã‚’åŠ ç®—ã€â†’ { stat: 'inspire', inspireSourceStat: 'attack', value: 30 }
```

### Phase 2: ãƒ­ã‚¸ãƒƒã‚¯å®Œæˆï¼ˆbuffs.tsï¼‰

1. `isBuffApplicable` ã®å°„ç¨‹åˆ¤å®šå®Ÿè£…
2. æ¡ä»¶ã‚¿ã‚°ï¼ˆConditionTagï¼‰ã®åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
3. å·¨å¤§åŒ–ãƒãƒ•ã®å‡¦ç†
4. å‹•çš„ãƒãƒ•ã®è­˜åˆ¥ã¨é™¤å¤–

### Phase 3: ãƒ†ã‚¹ãƒˆå……å®Ÿ

1. å„ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å˜ä½“ãƒ†ã‚¹ãƒˆ
2. è¤‡åˆãƒãƒ•ã®ãƒ†ã‚¹ãƒˆ
3. å®Ÿéš›ã®ã‚­ãƒ£ãƒ©ãƒ‡ãƒ¼ã‚¿ã§ã®çµåˆãƒ†ã‚¹ãƒˆ
4. å‹•çš„ãƒãƒ•ã®æ¤œå‡ºãƒ†ã‚¹ãƒˆ

### Phase 4: UIå®Ÿè£…

1. BuffStackBar ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
2. ReferenceGauge ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
3. FormationSummary ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆæ–°è¦ï¼‰
4. AttackerAnalysis ç”»é¢
5. å‹•çš„ãƒãƒ•ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤º

---

## 5. å‹å®šç¾©ã®æ‹¡å¼µæ¡ˆ

### 5.1 ParsedBuffï¼ˆãƒ‘ãƒ¼ã‚µãƒ¼å‡ºåŠ›å‹ï¼‰

buffParser.tsãŒå‡ºåŠ›ã™ã‚‹ä¸­é–“å‹ã§ã™ã€‚ã“ã®å‹ã¯æ—§buffParser.jsã®å‡ºåŠ›å½¢å¼ã«è¿‘ãã€å¾Œã§æ¨™æº–çš„ãªBuffå‹ã«å¤‰æ›ã•ã‚Œã¾ã™ã€‚

```typescript
// parser/types.ts
export interface ParsedBuff {
  type: string;          // 'æ”»æ’ƒå‰²åˆ', 'é˜²å¾¡å›ºå®š' ãªã©
  target: string;        // 'è‡ªèº«', 'å°„ç¨‹å†…', 'åŸå¨˜' ãªã©
  value: number;
  unit: string;          // '+%', '+' ãªã©
  isSpecial: boolean;    // ç‰¹æ®Šæ¡ä»¶ä»˜ãã‹
  hasCondition: boolean; // æ¡ä»¶ä»˜ãã‹
  conditionText?: string; // æ¡ä»¶ã®èª¬æ˜ãƒ†ã‚­ã‚¹ãƒˆ
  note: string;
  rawText: string;       // å…ƒã®ãƒ†ã‚­ã‚¹ãƒˆï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
}
```

### 5.2 WeaponInfo

æ­¦å™¨ç¨®ã®æƒ…å ±ã‚’è¡¨ã™å‹ã§ã™ã€‚**æ—¥æœ¬èªãƒ™ãƒ¼ã‚¹ã®è¡¨è¨˜ã‚’æ¡ç”¨**ã—ã¾ã™ã€‚

```typescript
// data/weaponMapping.ts
export interface WeaponInfo {
  range: 'è¿‘' | 'é ';
  type: 'ç‰©' | 'è¡“';
  placement: 'è¿‘' | 'é ' | 'é è¿‘';
}

export const weaponMapping: Record<string, WeaponInfo> = {
  "å¼“": { range: "é ", type: "ç‰©", placement: "é " },
  "é‰„ç ²": { range: "é ", type: "ç‰©", placement: "é " },
  "çŸ³å¼“": { range: "é ", type: "ç‰©", placement: "é " },
  "æŠ•å‰£": { range: "é ", type: "ç‰©", placement: "é è¿‘" },
  "è»èˆ¹": { range: "é ", type: "ç‰©", placement: "é è¿‘" },
  "æ§": { range: "è¿‘", type: "ç‰©", placement: "è¿‘" },
  "åˆ€": { range: "è¿‘", type: "ç‰©", placement: "è¿‘" },
  "ç›¾": { range: "è¿‘", type: "ç‰©", placement: "è¿‘" },
  "ãƒ©ãƒ³ã‚¹": { range: "è¿‘", type: "ç‰©", placement: "è¿‘" },
  "åŒå‰£": { range: "è¿‘", type: "ç‰©", placement: "è¿‘" },
  "æ‹³": { range: "è¿‘", type: "ç‰©", placement: "è¿‘" },
  "é­": { range: "è¿‘", type: "ç‰©", placement: "é è¿‘" },
  "èŒ¶å™¨": { range: "è¿‘", type: "ç‰©", placement: "é è¿‘" },
  "æ­Œèˆ": { range: "é ", type: "è¡“", placement: "é " },
  "æœ¬": { range: "é ", type: "è¡“", placement: "é " },
  "ç ²è¡“": { range: "é ", type: "è¡“", placement: "é " },
  "éˆ´": { range: "é ", type: "è¡“", placement: "é " },
  "æ–": { range: "é ", type: "è¡“", placement: "é " },
  "æœ­": { range: "é ", type: "è¡“", placement: "é " },
  "å¤§ç ²": { range: "é ", type: "ç‰©", placement: "é è¿‘" },
  "é™£è²": { range: "é ", type: "è¡“", placement: "é è¿‘" }
};
```

**æ¡ç”¨ç†ç”±**:
- ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚€éš›ã®ç›´æ„Ÿæ€§ãŒé«˜ã„
- æ—§ç‰ˆã¨ã®äº’æ›æ€§ã‚’ä¿ã¤
- TypeScriptã®å‹ãƒã‚§ãƒƒã‚¯ã®æ©æµã¯åŒæ§˜ã«å—ã‘ã‚‰ã‚Œã‚‹

### 5.3 ConditionTag ã®æ‹¡å¼µ

ãƒãƒ•ã®é©ç”¨æ¡ä»¶ã‚’è¡¨ã™ã‚¿ã‚°ã§ã™ã€‚è©³ç´°ãªè¨­è¨ˆã¯ `CONDITION_TAG_SPEC.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

```typescript
export type ConditionTag =
  // æ­¦å™¨ç³»ï¼ˆå„ªå…ˆåº¦ï¼šä¸­ï¼‰
  | 'melee' | 'ranged'
  | 'physical' | 'magical'
  // å±æ€§ç³»ï¼ˆå„ªå…ˆåº¦ï¼šä¸­ï¼‰
  | 'water' | 'plain' | 'mountain' | 'plain_mountain' | 'hell'
  // HPæ¡ä»¶ï¼ˆå„ªå…ˆåº¦ï¼šé«˜ï¼‰
  | 'hp_above_50' | 'hp_below_50'
  | 'hp_above_70' | 'hp_below_30' | 'hp_full'
  | 'hp_dependent'           // HPä¾å­˜ï¼ˆHPã«æ¯”ä¾‹ã—ã¦åŠ¹æœå¤‰å‹•ï¼‰
  // å·¨å¤§åŒ–æ®µéšæ¡ä»¶ï¼ˆå„ªå…ˆåº¦ï¼šä¸­ã€œä½ï¼‰
  | 'giant_1_plus' | 'giant_2_plus' | 'giant_3_plus' | 'giant_4_plus' | 'giant_5'
  // å­£ç¯€ç³»ï¼ˆå„ªå…ˆåº¦ï¼šä¸­ï¼‰
  | 'summer' | 'kenran' | 'halloween' | 'school'
  | 'christmas' | 'new_year' | 'moon_viewing' | 'bride'
  // å¯¾è±¡ç¨®åˆ¥ï¼ˆå„ªå…ˆåº¦ï¼šä¸­ã€œä½ï¼‰
  | 'castle_girl' | 'ambush' | 'lord'
  // æ•µç¨®åˆ¥ï¼ˆå„ªå…ˆåº¦ï¼šä¸­ï¼‰
  | 'flying_enemy' | 'ground_enemy' | 'boss_enemy'
  // ç‰¹æ®Šæ¡ä»¶ï¼ˆå„ªå…ˆåº¦ï¼šä½ã€œä¸­ï¼‰
  | 'same_weapon' | 'different_weapon'
  | 'night_battle' | 'continuous_deploy'
  | 'on_water'               // æ°´ä¸Šãƒãƒƒãƒ—
  | 'on_placement'           // é…ç½®æ™‚
  | 'exclude_self';          // è‡ªèº«ã‚’é™¤ã
```

### 5.4 é¼“èˆï¼ˆInspireï¼‰ã®ä»•æ§˜

é¼“èˆã¯ã€è‡ªèº«ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å‚ç…§ã—ã¦å‘³æ–¹ã«åŠ ç®—ã™ã‚‹ç‰¹æ®Šãªãƒãƒ•ã§ã™ã€‚é€šå¸¸ã®ãƒãƒ•ã¨ã¯è¨ˆç®—æ–¹æ³•ãŒç•°ãªã‚Šã¾ã™ã€‚

#### åŸºæœ¬æ§‹é€ 

```typescript
interface InspireBuff extends Buff {
  stat: 'inspire';
  mode: 'percent_max';
  value: number;                    // ä½•%ã‚’åŠ ç®—ã™ã‚‹ã‹
  inspireSourceStat: Stat;          // ã©ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å‚ç…§ã™ã‚‹ã‹
  target: 'range' | 'all';
}
```

#### ä¾‹ï¼šã€Œè‡ªèº«ã®æ”»æ’ƒã®30%ã‚’å°„ç¨‹å†…ã«åŠ ç®—ã€

```typescript
{
  id: 'inspire-001',
  stat: 'inspire',
  mode: 'percent_max',
  value: 30,
  inspireSourceStat: 'attack',      // è‡ªèº«ã®æ”»æ’ƒåŠ›ã‚’å‚ç…§
  target: 'range',
  source: 'self_skill',
  isActive: true
}
```

#### è¤‡æ•°ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å‚ç…§

ã€Œè‡ªèº«ã®æ”»æ’ƒã¨é˜²å¾¡ã®30%ã‚’å°„ç¨‹å†…ã«åŠ ç®—ã€ã®ã‚ˆã†ãªå ´åˆã€åˆ¥ã€…ã®Buffã¨ã—ã¦ç”Ÿæˆã—ã¾ã™ã€‚

```typescript
// æ”»æ’ƒã®é¼“èˆ
{
  stat: 'inspire',
  inspireSourceStat: 'attack',
  value: 30,
  target: 'range'
}

// é˜²å¾¡ã®é¼“èˆ
{
  stat: 'inspire',
  inspireSourceStat: 'defense',
  value: 30,
  target: 'range'
}
```

#### è¨ˆç®—æ–¹æ³•ï¼ˆæ¦‚å¿µï¼‰

è©³ç´°ãªãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—å¼ã¯ `DAMAGE_CALCULATOR_SPEC.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

```
1. ã‚­ãƒ£ãƒ©Aã®åŸºç¤æ”»æ’ƒåŠ› = 1000
2. ã‚­ãƒ£ãƒ©Aã«æ”»æ’ƒ+50%ãƒãƒ• = 1000 Ã— 1.5 = 1500
3. ã‚­ãƒ£ãƒ©Aã¯ã€Œè‡ªèº«ã®æ”»æ’ƒã®30%ã‚’é¼“èˆã€ã‚’æŒã¤
4. é¼“èˆã§å‘³æ–¹ã«åŠ ç®—ã•ã‚Œã‚‹å€¤ = 1500 Ã— 0.3 = 450
5. å‘³æ–¹ã‚­ãƒ£ãƒ©Bã®æ”»æ’ƒåŠ› = 800 + 450 = 1250
```

### 5.5 åŠ¹æœé‡è¤‡ï¼ˆDuplicateï¼‰ã®ä»•æ§˜

ã€ŒåŠ¹æœé‡è¤‡ã€ãŒä»˜ã„ãŸãƒãƒ•ã¯ã€é€šå¸¸ã®ãƒãƒ•ã¨ã¯ç•°ãªã‚‹è¨ˆç®—ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å‡¦ç†ã•ã‚Œã¾ã™ã€‚

#### ãƒ•ãƒ©ã‚°ä»˜ä¸

```typescript
{
  stat: 'enemy_defense',
  mode: 'percent_max',
  value: 5,
  isDuplicate: true,     // åŠ¹æœé‡è¤‡ãƒ•ãƒ©ã‚°
  target: 'range'
}
```

#### UIè¡¨ç¤º

åŠ¹æœé‡è¤‡ãƒãƒ•ã¯ã€ãƒãƒƒã‚¸ã§è¦–è¦šçš„ã«åŒºåˆ¥ã—ã¾ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å°„ç¨‹å†…/æ•µé˜²å¾¡-5%        â”‚
â”‚ [é‡è¤‡] â† ãƒãƒƒã‚¸è¡¨ç¤º    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è¨ˆç®—æ–¹æ³•ï¼ˆæ¦‚å¿µï¼‰

è©³ç´°ãªè¨ˆç®—å¼ã¯ `DAMAGE_CALCULATOR_SPEC.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

```
é€šå¸¸ãƒãƒ•ãƒ•ã‚§ãƒ¼ã‚º:
  æ”»æ’ƒåŠ› = (åŸºç¤æ”»æ’ƒåŠ› Ã— å‰²åˆãƒãƒ•) + å›ºå®šãƒãƒ•

åŠ¹æœé‡è¤‡ãƒãƒ•ãƒ•ã‚§ãƒ¼ã‚º:
  æ”»æ’ƒåŠ› = æ”»æ’ƒåŠ› Ã— (1 + åŠ¹æœé‡è¤‡ãƒãƒ•%)

ãƒ€ãƒ¡ãƒ¼ã‚¸ä¹—ç®—ãƒ•ã‚§ãƒ¼ã‚º:
  ãƒ€ãƒ¡ãƒ¼ã‚¸ = æ”»æ’ƒåŠ› Ã— ä¸ãƒ€ãƒ¡ Ã— è¢«ãƒ€ãƒ¡ Ã— ...
```

### 5.6 å‹•çš„ãƒãƒ•ï¼ˆDynamic Buffsï¼‰ã®ä»•æ§˜

ç·¨æˆæ§‹ç¯‰æ™‚ã«å…·ä½“çš„ãªå€¤ãŒç¢ºå®šã§ããªã„ãƒãƒ•ã‚’ã€Œå‹•çš„ãƒãƒ•ã€ã¨ã—ã¦åˆ†é¡ã—ã¾ã™ã€‚

#### 2ã¤ã®ã‚«ãƒ†ã‚´ãƒª

```typescript
// ç·¨æˆä¾å­˜ï¼šä¼å…µæ•°ã€å‘³æ–¹æ•°ãªã©ï¼ˆæƒ³å®šå€¤ã‚’ç¤ºã›ã‚‹ï¼‰
{
  isDynamic: true,
  dynamicCategory: 'formation',
  dynamicType: 'per_ally_other',
  unitValue: 150,  // å‘³æ–¹1ä½“ã«ã¤ã+150
  note: 'å‘³æ–¹1ä½“ã«ã¤ãæ”»æ’ƒ+150ï¼ˆæœ€å¤§7ä½“ï¼š+1050ï¼‰'
}

// æˆ¦é—˜çŠ¶æ³ä¾å­˜ï¼šæ•µæ•°ãªã©ï¼ˆäºˆæ¸¬ä¸å¯èƒ½ï¼‰
{
  isDynamic: true,
  dynamicCategory: 'combat_situation',
  dynamicType: 'per_enemy_in_range',
  unitValue: 12,  // æ•µ1ä½“ã«ã¤ã+12%
  note: 'å°„ç¨‹å†…æ•µ1ä½“æ¯ã«é˜²å¾¡+12%'
}
```

#### UIè¨­è¨ˆ

å‹•çš„ãƒãƒ•ã¯ã€Œå‹•çš„ãƒãƒ•ï¼ˆå‚è€ƒæƒ…å ±ï¼‰ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«åˆ¥æ è¡¨ç¤ºã—ã¾ã™ã€‚

```
ã€å‹•çš„ãƒãƒ•ï¼ˆå‚è€ƒæƒ…å ±ï¼‰ã€‘
âš ï¸ å®Ÿéš›ã®åŠ¹æœã¯æˆ¦é—˜æ¡ä»¶ã«ã‚ˆã£ã¦å¤‰å‹•ã—ã¾ã™

ã‚­ãƒ£ãƒ©Cï¼ˆè‡ªèº«ï¼‰:
  ğŸ”„ é˜²å¾¡ +12%/æ•µï¼ˆå°„ç¨‹å†…ã®æ•µ1ä½“æ¯ï¼‰
     - 5ä½“ï¼š+60%
     - 10ä½“ï¼š+120%
     - å·¨å¤§åŒ–5ã®ã¿ã€é‡è¤‡ã‚ã‚Š
```

è©³ç´°ã¯ `PARSING_RULES.md` ã®ãƒ‘ã‚¿ãƒ¼ãƒ³21ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## 6. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### 6.1 å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆãƒ‘ãƒ¼ã‚µãƒ¼ï¼‰

```typescript
// parser/__tests__/buffParser.test.ts
describe('parseSkillLine', () => {
  test.each([
    ['æ”»æ’ƒãŒ30%ä¸Šæ˜‡', { stat: 'attack', value: 30, mode: 'percent_max' }],
    ['æ”»æ’ƒãŒ50ä¸Šæ˜‡', { stat: 'attack', value: 50, mode: 'flat_sum' }],
    ['å°„ç¨‹å†…ã®åŸå¨˜ã®æ”»æ’ƒãŒ20%ä¸Šæ˜‡', { stat: 'attack', value: 20, target: 'range' }],
    ['è‡ªèº«ã®æ”»æ’ƒé€Ÿåº¦ãŒ15%ä¸Šæ˜‡', { stat: 'attack_speed', value: 15 }],
    ['éš™ãŒ30%çŸ­ç¸®', { stat: 'attack_gap', mode: 'percent_reduction', value: 30 }],
    ['è‡ªèº«ã®æ”»æ’ƒã®30%ã‚’å°„ç¨‹å†…ã«åŠ ç®—', { 
      stat: 'inspire', 
      inspireSourceStat: 'attack', 
      value: 30,
      target: 'range'
    }],
  ])('"%s" â†’ %o', (input, expected) => {
    const result = parseSkillLine(input);
    expect(result[0]).toMatchObject(expected);
  });
});
```

### 6.2 çµåˆãƒ†ã‚¹ãƒˆï¼ˆç·¨æˆè¨ˆç®—ï¼‰

```typescript
describe('calcBuffMatrix with real data', () => {
  test('æ±Ÿæˆ¸åŸã®å…¨ä½“ãƒãƒ•ãŒå…¨å“¡ã«é©ç”¨ã•ã‚Œã‚‹', () => {
    // ...
  });
  
  test('é¼“èˆãƒãƒ•ãŒæ­£ã—ãè¨ˆç®—ã•ã‚Œã‚‹', () => {
    // ...
  });
  
  test('åŠ¹æœé‡è¤‡ãƒãƒ•ãŒåˆ¥ãƒ•ã‚§ãƒ¼ã‚ºã§å‡¦ç†ã•ã‚Œã‚‹', () => {
    // ...
  });
  
  test('å‹•çš„ãƒãƒ•ãŒä¸»è¨ˆç®—ã‹ã‚‰é™¤å¤–ã•ã‚Œã‚‹', () => {
    // ...
  });
});
```

---

## 7. æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### ä»Šã™ãã‚„ã‚‹ã“ã¨
1. âœ… è¨­è¨ˆæ›¸ä½œæˆï¼ˆæœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰
2. âœ… å‹å¤‰æ›ãƒãƒƒãƒ”ãƒ³ã‚°ä»•æ§˜æ›¸ä½œæˆï¼ˆTYPE_CONVERSION_MAPPING.mdï¼‰
3. âœ… CONDITION_TAGä»•æ§˜æ›¸ä½œæˆï¼ˆCONDITION_TAG_SPEC.mdï¼‰
4. âœ… ãƒ‘ãƒ¼ã‚·ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«é›†ä½œæˆï¼ˆPARSING_RULES.mdï¼‰
5. âœ… ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—ä»•æ§˜æ›¸ä½œæˆï¼ˆDAMAGE_CALCULATOR_SPEC.mdï¼‰
6. âœ… patterns.ts ã®ä½œæˆ
7. âœ… buffParser.ts ã®ç§»æ¤
8. ğŸ”² UIè¨­è¨ˆã®è©³ç´°åŒ–

### é‡è¦ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **ARCHITECTURE.mdï¼ˆæœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰** - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®è¨­è¨ˆæ›¸
- **TYPE_CONVERSION_MAPPING.md** - å‹å¤‰æ›ã®å®Œå…¨ãªä»•æ§˜
- **CONDITION_TAG_SPEC.md** - æ¡ä»¶ã‚¿ã‚°ã®å®Œå…¨ãªå®šç¾©
- **PARSING_RULES.md** - Wikiãƒ†ã‚­ã‚¹ãƒˆè§£æã®23å€‹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³
- **DAMAGE_CALCULATOR_SPEC.md** - ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—å¼ã®è©³ç´°ä»•æ§˜

---

## 8. å‚è€ƒï¼šUIè¨­è¨ˆï¼ˆä»•æ§˜æ›¸ã‚ˆã‚Šï¼‰

### BuffMatrix ã®ã‚»ãƒ«è¡¨ç¤º
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â— â—¯ â—  (èª°ã‹ã‚‰ãƒãƒ•ã‚’å—ã‘ã¦ã„ã‚‹ã‹) â”‚
â”‚ [â– â– â–¡â–¡] 30% (è‡ª20% + å‘³æ–¹10%)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é¼“èˆãƒãƒ•ã®è¡¨ç¤º
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸº å°„ç¨‹å†…/é¼“èˆï¼ˆæ”»æ’ƒï¼‰   â”‚
â”‚    è‡ªèº«ã®æ”»æ’ƒã®30%ã‚’åŠ ç®— â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŠ¹æœé‡è¤‡ãƒãƒ•ã®è¡¨ç¤º
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å°„ç¨‹å†…/æ•µé˜²å¾¡-5%        â”‚
â”‚ [é‡è¤‡] â† ãƒãƒƒã‚¸        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‹•çš„ãƒãƒ•ã®è¡¨ç¤º
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ æ”»æ’ƒ +150/å‘³æ–¹     â”‚
â”‚    å‹•çš„ï¼ˆç·¨æˆä¾å­˜ï¼‰    â”‚
â”‚    7ä½“ï¼š+1050         â”‚
â”‚    10ä½“ï¼š+1500        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¼å…µãƒãƒ•ã®è¡¨ç¤º
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš¡ æ”»æ’ƒ +120          â”‚
â”‚    ä¼å…µã®å°„ç¨‹å†…       â”‚
â”‚    é…ç½®ä½ç½®ã«ä¾å­˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚²ãƒ¼ã‚¸
```
[====|=====|===] 75%
 èµ¤(ä¸è¶³) ç·‘(é©æ­£) é’(éå‰°)
```

### ç·¨æˆã‚µãƒãƒªãƒ¼ï¼ˆæ–°è¦ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã€ç·¨æˆæ§‹æˆã€‘          â”‚
â”‚ è¿‘æ¥: 5ä½“  é éš”: 3ä½“  â”‚
â”‚ æ°´: 2  å¹³: 3  å±±: 2   â”‚
â”‚                      â”‚
â”‚ âš ï¸ å¹³åŸ3ä½“åˆ¶é™è¶…é    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. Wikiãƒ‘ãƒ¼ã‚µãƒ¼ã®å®Ÿè£…çŸ¥è¦‹

### 9.1 ç‰¹æ®Šèƒ½åŠ› vs ç‰¹æ®Šæ”»æ’ƒ

Wikiã«ã¯ã€Œç‰¹æ®Šèƒ½åŠ›ã€ã¨ã€Œç‰¹æ®Šæ”»æ’ƒã€ã¨ã„ã†åˆ¥ã€…ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ã¾ã™ã€‚

- **ç‰¹æ®Šèƒ½åŠ›**: ãƒ‘ãƒƒã‚·ãƒ–ã‚¹ã‚­ãƒ«ï¼ˆæ°—(ç‰›)ãªã©ãŒå«ã¾ã‚Œã‚‹ï¼‰
- **ç‰¹æ®Šæ”»æ’ƒ**: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ã‚­ãƒ«ï¼ˆã‚¹ãƒˆãƒƒã‚¯æ¶ˆè²»æ”»æ’ƒãªã©ï¼‰

ãƒ‘ãƒ¼ã‚µãƒ¼ã¯ç‰¹æ®Šæ”»æ’ƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’é™¤å¤–ã—ã€ç‰¹æ®Šèƒ½åŠ›ã®ã¿ã‚’æŠ½å‡ºã—ã¾ã™ã€‚

### 9.2 åŠ¹æœé‡è¤‡ã®ä½ç½®ãƒ™ãƒ¼ã‚¹åˆ¤å®š

ã€Œ(åŒç¨®åŠ¹æœã¨é‡è¤‡)ã€ã®ã‚ˆã†ãªè¡¨è¨˜ã¯ã€**ãã®è¡¨è¨˜ã‚ˆã‚Šå‰ã®ãƒãƒ•ã«ã®ã¿é©ç”¨**ã•ã‚Œã¾ã™ã€‚

```
ä¾‹: æ”»æ’ƒ1.2å€(åŒç¨®åŠ¹æœã¨é‡è¤‡)è¢«ãƒ€ãƒ¡ãƒ¼ã‚¸1.5å€(è‡ªåˆ†ã®ã¿)
â†’ æ”»æ’ƒ1.2å€: isDuplicate = true
â†’ è¢«ãƒ€ãƒ¡ãƒ¼ã‚¸1.5å€: isDuplicate = falseï¼ˆåŠ¹æœé‡è¤‡ã‚ˆã‚Šå¾Œã‚ãªã®ã§ï¼‰
```

### 9.3 ä¸¦åˆ—è¡¨è¨˜ã®å±•é–‹é †åº

ã€Œæ”»æ’ƒã¨æ”»æ’ƒé€Ÿåº¦ã€ã®ã‚ˆã†ãªä¸¦åˆ—è¡¨è¨˜ã‚’å±•é–‹ã™ã‚‹éš›ã€**é•·ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å…ˆã«ãƒãƒƒãƒ**ã•ã›ã¾ã™ã€‚

```typescript
const statPattern = 'æ”»æ’ƒé€Ÿåº¦|ç§»å‹•é€Ÿåº¦|æ”»æ’ƒ(?:åŠ›)?|é˜²å¾¡(?:åŠ›)?|å°„ç¨‹|...';
// ã€Œæ”»æ’ƒé€Ÿåº¦ã€ã‚’ã€Œæ”»æ’ƒã€ã‚ˆã‚Šå…ˆã«å®šç¾©ã™ã‚‹ã“ã¨ã§èª¤ãƒãƒƒãƒã‚’é˜²æ­¢
```

### 9.4 å¾ã€…æ°—ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å³æ ¼åŒ–

ä»¥ä¸‹ã®ã‚ˆã†ãªèª¤æ¤œçŸ¥ã‚’é˜²ããŸã‚ã€å¾ã€…æ°—ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯å³æ ¼ã«å®šç¾©ã—ã¾ã™:

```
âŒ èª¤æ¤œçŸ¥: ã€Œæ™‚é–“çµŒéã§ã‚‚è“„ç©...ç²å¾—æ°—ãŒ2å¢—åŠ ã€
   â†’ ã€Œæ™‚é–“çµŒéã§ã€ã¨ã€Œç²å¾—æ°—ãŒ2ã€ãŒé›¢ã‚Œã¦ã„ã¦ã‚‚ãƒãƒƒãƒã—ã¦ã—ã¾ã†

âœ“ æ­£ã—ã„ãƒ‘ã‚¿ãƒ¼ãƒ³: æ™‚é–“çµŒéã§æ°—ãŒ(?:å¾ã€…ã«)?(\d+)(?:å¢—åŠ |å›å¾©)
   â†’ ã€Œæ™‚é–“çµŒéã§æ°—ãŒã€ãŒç›´æ¥ç¶šãå ´åˆã®ã¿ãƒãƒƒãƒ
```

---

## 10. å¤‰æ›´å±¥æ­´

### v2.1 (2025-12-14)
- æ°—ãƒãƒ•ã‚’ç¨®é¡ã”ã¨ã«å°‚ç”¨Statã«åˆ†é›¢ï¼ˆcost_gradual, cost_giant, cost_enemy_defeat, cost_defeat_bonus, cost_strategyï¼‰
- æ•µã®è¢«ãƒ€ãƒ¡/ä¸ãƒ€ãƒ¡é–¢é€£Statè¿½åŠ ï¼ˆenemy_damage_taken, enemy_damage_dealtï¼‰
- enemy_knockback ã‚’ enemy_retreat ã«å¤‰æ›´
- Wikiãƒ‘ãƒ¼ã‚µãƒ¼ã®å®Ÿè£…çŸ¥è¦‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
- åŠ¹æœé‡è¤‡ã®ä½ç½®ãƒ™ãƒ¼ã‚¹åˆ¤å®šä»•æ§˜ã‚’è¿½åŠ 

### v2.0 (2025-12-07)
- Targetã®6ç¨®é¡ã‚’æ˜è¨˜ï¼ˆself, ally, range, all, field, out_of_rangeï¼‰
- TARGET_NORMALIZATION.mdã®å†…å®¹ã‚’çµ±åˆ
- weaponMappingã‚’æ—¥æœ¬èªãƒ™ãƒ¼ã‚¹ï¼ˆ'è¿‘', 'é ', 'ç‰©', 'è¡“'ï¼‰ã«å¤‰æ›´
- å‹•çš„ãƒãƒ•ã®è©³ç´°ä»•æ§˜ã‚’è¿½åŠ 
- ä¼å…µãƒãƒ•ï¼ˆrequiresAmbushï¼‰ã®ä»•æ§˜ã‚’è¿½åŠ 
- è¨ˆç•¥ç¯„å›²ãƒãƒ•ã®æ‰±ã„ã‚’æ˜è¨˜
- æ‰‹å‹•ç·¨é›†ã‚µãƒãƒ¼ãƒˆï¼ˆconfidenceï¼‰ã‚’è¿½åŠ 
- ç·¨æˆã‚µãƒãƒªãƒ¼æ©Ÿèƒ½ã‚’è¿½åŠ 
- DAMAGE_CALCULATOR_SPEC.mdã¸ã®å‚ç…§ã‚’è¿½åŠ 

### v1.0 (2025-12-06)
- åˆç‰ˆä½œæˆ
- åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å®šç¾©

---

*Last Updated: 2025-12-14*
*Version: 2.1*
