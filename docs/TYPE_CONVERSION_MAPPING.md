# ShiroPro Tools (Reborn) - å‹å¤‰æ›ãƒãƒƒãƒ”ãƒ³ã‚°ä»•æ§˜æ›¸

**Version**: 1.2  
**Status**: ä»•æ§˜ç¢ºå®š âœ…  
**Last Updated**: 2025-12-07

---

## ğŸ“‹ ç›®çš„

æ—§buffParser.jsï¼ˆJavaScriptï¼‰ã®å‡ºåŠ›ã‚’ã€Rebornç‰ˆï¼ˆTypeScriptï¼‰ã®å‹å®šç¾©ã«æ­£ç¢ºã«å¤‰æ›ã™ã‚‹ãŸã‚ã®ãƒãƒƒãƒ”ãƒ³ã‚°å®šç¾©ã§ã™ã€‚

ã“ã®ä»•æ§˜æ›¸ã¯ã€ä»¥ä¸‹ã®ç›®çš„ã§ä½¿ç”¨ã•ã‚Œã¾ã™ï¼š

- **parser/buffParser.ts** ã®å®Ÿè£…ã‚¬ã‚¤ãƒ‰
- **parser/converter.ts** ã®å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯è¨­è¨ˆ
- **ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹** ã®ä½œæˆåŸºæº–
- **å‹å®šç¾©** ã®æ‹¡å¼µæ™‚ã®å‚ç…§

---

## ğŸ¯ è¨­è¨ˆæ–¹é‡

### 1. æ˜ç¢ºãªè²¬å‹™åˆ†é›¢

ãƒãƒ•ã®ç¨®é¡ã‚’ç›®çš„åˆ¥ã«æ˜ç¢ºã«åˆ†é¡ã™ã‚‹ã“ã¨ã§ã€è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã®è¦‹é€šã—ã‚’è‰¯ãã—ã¾ã™ã€‚

- **ç·¨æˆãƒãƒ•ãƒ‘ã‚ºãƒ«ç”¨**: å‘³æ–¹ã¸ã®ç›´æ¥ãƒãƒ•ï¼ˆæ”»æ’ƒåŠ›ã€é˜²å¾¡åŠ›ã€å°„ç¨‹ç­‰ï¼‰
- **ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—ç”¨**: ä¹—ç®—ç³»ãƒãƒ•ã€ä¸ãƒ€ãƒ¡ã€è¢«ãƒ€ãƒ¡ç­‰
- **æ•µãƒ‡ãƒãƒ•ç”¨**: æ•µã¸ã®é˜²å¾¡ä½ä¸‹ã€ç§»å‹•é€Ÿåº¦ä½ä¸‹ç­‰

### 2. å‹å®‰å…¨æ€§ã®ç¢ºä¿

æ›–æ˜§ãªåˆ†é¡ã‚’é¿ã‘ã€ãã‚Œãã‚Œã®åŠ¹æœã«å°‚ç”¨ã®`Stat`ã‚’å®šç¾©ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€TypeScriptã®å‹ãƒã‚§ãƒƒã‚¯ã§å¤šãã®ãƒã‚°ã‚’æœªç„¶ã«é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚

ä¾‹ãˆã°ã€ã€Œé€Ÿåº¦ã€ã¨ã€Œéš™ã€ã¯åŒã˜`cooldown`ã¨ã—ã¦æ‰±ã†ã®ã§ã¯ãªãã€`attack_speed`ã¨`attack_gap`ã¨ã—ã¦æ˜ç¢ºã«åˆ†é›¢ã—ã¾ã™ã€‚

### 3. UIè¡¨ç¤ºã¸ã®é…æ…®

é¼“èˆã‚„åŠ¹æœé‡è¤‡ãªã©ã®ç‰¹æ®ŠåŠ¹æœã‚’ã€ãƒ•ãƒ©ã‚°ã‚„ã‚µãƒ–ã‚¿ã‚¤ãƒ—ã¨ã—ã¦æ˜ç¤ºçš„ã«ç®¡ç†ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€UIã§ãƒãƒƒã‚¸ã‚„ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä½¿ã£ãŸè¦–è¦šçš„ãªåŒºåˆ¥ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚

### 4. Target ã¨ ConditionTag ã®åˆ†é›¢ï¼ˆv1.2ã§è¿½åŠ ï¼‰

**é‡è¦ãªè¨­è¨ˆåŸå‰‡**: targetã¯ã€Œç¯„å›²ã€ã‚’è¡¨ã—ã€ConditionTagã¯ã€Œãã®ç¯„å›²å†…ã§ã®çµã‚Šè¾¼ã¿ã€ã‚’è¡¨ã—ã¾ã™ã€‚

```typescript
// å°„ç¨‹å†…ã®è¿‘æ¥åŸå¨˜ã®æ”»æ’ƒãŒ50%ä¸Šæ˜‡
{
  stat: 'attack',
  target: 'range',           // ç¯„å›²ï¼šå°„ç¨‹å†…
  conditionTags: ['melee'],  // çµã‚Šè¾¼ã¿ï¼šè¿‘æ¥ã®ã¿
  value: 50
}
```

---

## ğŸ“Š å®Œå…¨ãªå‹å®šç¾©

### Statï¼ˆãƒãƒ•ç¨®åˆ¥ï¼‰

ãƒãƒ•ã®ç¨®åˆ¥ã‚’è¡¨ã™å‹ã§ã™ã€‚ä»¥ä¸‹ã®4ã¤ã®ã‚«ãƒ†ã‚´ãƒªã«åˆ†é¡ã•ã‚Œã¾ã™ã€‚

```typescript
// ========================================
// å‘³æ–¹ãƒãƒ•ç³»ï¼ˆç·¨æˆãƒ‘ã‚ºãƒ«ï¼‹ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—ï¼‰
// ========================================
type AllyBuffStat = 
  | 'attack'              // æ”»æ’ƒåŠ›
  | 'defense'             // é˜²å¾¡åŠ›
  | 'range'               // å°„ç¨‹
  | 'attack_speed'        // æ”»æ’ƒé€Ÿåº¦ï¼ˆæ—§ç‰ˆã®ã€Œé€Ÿåº¦ã€ï¼‰
  | 'attack_gap'          // æ”»æ’ƒéš™ï¼ˆæ—§ç‰ˆã®ã€Œéš™ã€ï¼‰
  | 'recovery'            // å›å¾©åŠ›
  | 'cost'                // æ°—ï¼ˆæ¶ˆè²»ãƒ»ç²å¾—ï¼‰
  | 'strategy_cooldown'   // è¨ˆç•¥å†ä½¿ç”¨æ™‚é–“
  | 'target_count'        // æ”»æ’ƒå¯¾è±¡æ•°
  | 'attack_count';       // æ”»æ’ƒå›æ•°

// ========================================
// ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—å°‚ç”¨ãƒãƒ•ï¼ˆä¹—ç®—ç³»ï¼‰
// ========================================
type DamageMultiplierStat =
  | 'damage_dealt'        // ä¸ãƒ€ãƒ¡
  | 'give_damage'         // ä¸ãˆã‚‹ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼ˆåˆ¥è¨ˆç®—å¼ï¼‰
  | 'damage_taken'        // è¢«ãƒ€ãƒ¡ï¼ˆæ•µå´ï¼‰
  | 'damage_recovery';    // ä¸ãƒ€ãƒ¡å›å¾©

// ========================================
// æ•µãƒ‡ãƒãƒ•ç³»ï¼ˆãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—å°‚ç”¨ï¼‰
// ========================================
type EnemyDebuffStat =
  | 'enemy_attack'                      // æ•µã®æ”»æ’ƒåŠ›ä½ä¸‹
  | 'enemy_defense'                     // æ•µã®é˜²å¾¡åŠ›ä½ä¸‹
  | 'enemy_defense_ignore_percent'      // å‰²åˆé˜²å¾¡ç„¡è¦–ï¼ˆâ—‹%ï¼‰
  | 'enemy_defense_ignore_complete'     // å®Œå…¨é˜²å¾¡ç„¡è¦–
  | 'enemy_movement'                    // æ•µã®ç§»å‹•é€Ÿåº¦ä½ä¸‹
  | 'enemy_knockback';                  // ãƒãƒƒã‚¯ãƒãƒƒã‚¯

// ========================================
// ç‰¹æ®Šãƒãƒ•ç³»
// ========================================
type SpecialBuffStat =
  | 'inspire';            // é¼“èˆï¼ˆå°‚ç”¨è¨ˆç®—ï¼‰

// å…¨ã¦ã®Statã®çµ±åˆå‹
type Stat = AllyBuffStat | DamageMultiplierStat | EnemyDebuffStat | SpecialBuffStat;
```

#### é‡è¦ãªè¨­è¨ˆæ±ºå®šï¼šé€Ÿåº¦ã¨éš™ã®åˆ†é›¢

æ—§ç‰ˆã§ã¯`cooldown`ã¨ã—ã¦ä¸€ç·’ã«æ‰±ã£ã¦ã„ãŸã€Œæ”»æ’ƒé€Ÿåº¦ã€ã¨ã€Œæ”»æ’ƒéš™ã€ã‚’ã€åˆ¥ã€…ã®`Stat`ã¨ã—ã¦åˆ†é›¢ã—ã¾ã—ãŸã€‚

**ç†ç”±**ï¼š
- æ”»æ’ƒé€Ÿåº¦ï¼šæ”»æ’ƒã®é »åº¦ã‚’ä¸Šã’ã‚‹ï¼ˆå˜ä½æ™‚é–“ã‚ãŸã‚Šã®æ”»æ’ƒå›æ•°å¢—åŠ ï¼‰
- æ”»æ’ƒéš™ï¼šæ”»æ’ƒå¾Œã®ç¡¬ç›´æ™‚é–“ã‚’çŸ­ç¸®ï¼ˆæ”»æ’ƒå¾Œã®æ¬¡ã®è¡Œå‹•ã¾ã§ã®æ™‚é–“çŸ­ç¸®ï¼‰

ã“ã®2ã¤ã¯è¨ˆç®—å¼ãŒç•°ãªã‚‹ãŸã‚ã€æ˜ç¢ºã«åˆ†é›¢ã™ã‚‹ã“ã¨ã§ãƒ­ã‚¸ãƒƒã‚¯ã®è¦‹é€šã—ãŒè‰¯ããªã‚Šã¾ã™ã€‚

### BuffModeï¼ˆé©ç”¨æ–¹å¼ï¼‰

```typescript
type BuffMode = 
  | 'percent_max'        // å‰²åˆãƒãƒ•ï¼ˆ+30%ï¼‰
  | 'flat_sum'           // å›ºå®šå€¤åŠ ç®—ï¼ˆ+50ï¼‰
  | 'percent_reduction'; // å‰²åˆæ¸›å°‘ï¼ˆéš™çŸ­ç¸®30%, æ°—è»½æ¸›20%ç­‰ï¼‰
```

### Targetï¼ˆãƒãƒ•ã®ç¯„å›²ï¼‰- v1.2ã§è¿½åŠ 

**é‡è¦ãªè¨­è¨ˆåŸå‰‡**: targetã¯ã€Œç¯„å›²ã€ã‚’è¡¨ã—ã€ConditionTagã¯ã€Œãã®ç¯„å›²å†…ã§ã®çµã‚Šè¾¼ã¿ã€ã‚’è¡¨ã—ã¾ã™ã€‚

```typescript
type Target = 
  | 'self'           // è‡ªåˆ†è‡ªèº«
  | 'ally'           // å¯¾è±¡æŒ‡å®šï¼ˆ1ä½“ï¼‰
  | 'range'          // å°„ç¨‹å†…
  | 'all'            // å…¨ä½“
  | 'field'          // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å…¨ä½“ï¼ˆæ°—ãªã©ï¼‰
  | 'out_of_range';  // å°„ç¨‹å¤–
```

**å„Targetã®è©³ç´°**:

| Target | æ„å‘³ | ä¾‹ | ãƒãƒ•ãƒ‘ã‚ºãƒ«ã§ã®æ‰±ã„ |
|--------|------|-----|-----------------|
| `self` | è‡ªåˆ†è‡ªèº« | ã€Œè‡ªèº«ã®æ”»æ’ƒãŒ30%ä¸Šæ˜‡ã€ | è‡ªåˆ†ã®ã‚»ãƒ«ã«ã®ã¿åæ˜  |
| `ally` | å¯¾è±¡æŒ‡å®šï¼ˆ1ä½“ï¼‰ | ã€Œå¯¾è±¡ã®æ”»æ’ƒãŒ50%ä¸Šæ˜‡ã€ | è¨ˆç•¥ã§é¸æŠã—ãŸå‘³æ–¹ã«åæ˜  |
| `range` | å°„ç¨‹å†… | ã€Œå°„ç¨‹å†…ã®å‘³æ–¹ã®æ”»æ’ƒãŒ20%ä¸Šæ˜‡ã€ | å°„ç¨‹åˆ¤å®šã§é©ç”¨ |
| `all` | å…¨ä½“ | ã€Œå…¨ã¦ã®åŸå¨˜ã®æ”»æ’ƒãŒ15%ä¸Šæ˜‡ã€ | ç·¨æˆå…¨å“¡ã«åæ˜  |
| `field` | ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å…¨ä½“ | ã€Œè‡ªç„¶ã«æ°—ãŒ5å¢—åŠ ã€ | å°‚ç”¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¡¨ç¤º |
| `out_of_range` | å°„ç¨‹å¤– | ã€Œå°„ç¨‹å¤–ã®å‘³æ–¹ã®é˜²å¾¡ãŒ30%ä¸Šæ˜‡ã€ | å°„ç¨‹å¤–åˆ¤å®šã§é©ç”¨ |

### ã‚µãƒ–ã‚¿ã‚¤ãƒ—å®šç¾©

#### CostBuffTypeï¼ˆæ°—ãƒãƒ•ã®ã‚µãƒ–ã‚¿ã‚¤ãƒ—ï¼‰

```typescript
type CostBuffType = 
  | 'natural'        // è‡ªç„¶å›å¾©ï¼ˆç§’é–“â—‹å¢—åŠ ï¼‰
  | 'enemy_defeat'   // æ•µæ’ƒç ´æ™‚ï¼ˆç‰›ï¼‰
  | 'ally_defeat'    // åŸå¨˜æ’ƒç ´æ™‚ï¼ˆãƒãƒ“ï¼‰
  | 'gradual'        // å¾ã€…ã«å¢—åŠ 
  | 'strategy_use'   // è¨ˆç•¥ä½¿ç”¨æ™‚
  | 'strategy_cost'  // è¨ˆç•¥æ¶ˆè²»æ°—æ¸›å°‘ï¼ˆâ€»å›ºå®šå€¤ãŒå¤šã„ï¼‰
  | 'giant_cost';    // å·¨å¤§åŒ–æ°—è»½æ¸›
```

**é‡è¦**: æ°—ãƒãƒ•ã¯å¿…ãš `target: 'field'` ã¨ãªã‚Šã¾ã™ã€‚æ°—ã¯ç·¨æˆå…¨ä½“ã§å…±æœ‰ã•ã‚Œã‚‹ãƒªã‚½ãƒ¼ã‚¹ã§ã‚ã‚Šã€å€‹åˆ¥ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ã¯ãªã„ãŸã‚ã§ã™ã€‚

#### DynamicBuffTypeï¼ˆå‹•çš„ãƒãƒ•ã®ã‚µãƒ–ã‚¿ã‚¤ãƒ—ï¼‰- v1.2ã§è¿½åŠ 

```typescript
type DynamicBuffType = 
  | 'per_enemy_in_range'      // å°„ç¨‹å†…æ•µ1ä½“æ¯
  | 'per_ally_in_range'       // å°„ç¨‹å†…å‘³æ–¹1ä½“æ¯
  | 'per_ally_other'          // å‘³æ–¹1ä½“æ¯ï¼ˆè‡ªèº«é™¤ãï¼‰
  | 'per_ambush_deployed'     // é…ç½®ã•ã‚ŒãŸä¼å…µ1ä½“æ¯
  | 'per_enemy_defeated'      // æ’ƒç ´ã—ãŸæ•µ1ä½“æ¯
  | 'per_specific_attribute'  // ç‰¹å®šå±æ€§ã®åŸå¨˜1ä½“æ¯
  | 'per_specific_weapon';    // ç‰¹å®šæ­¦å™¨ç¨®ã®åŸå¨˜1ä½“æ¯
```

**å‹•çš„ãƒãƒ•ã®å®šç¾©**: ç·¨æˆæ§‹ç¯‰æ™‚ã«å…·ä½“çš„ãªå€¤ãŒç¢ºå®šã§ããªã„ãƒãƒ•ã€‚

**2ã¤ã®ã‚«ãƒ†ã‚´ãƒª**:
- `formation`: ç·¨æˆä¾å­˜ï¼ˆä¼å…µæ•°ã€å‘³æ–¹æ•°ãªã©ã€‚æƒ³å®šå€¤ã‚’ç¤ºã›ã‚‹ï¼‰
- `combat_situation`: æˆ¦é—˜çŠ¶æ³ä¾å­˜ï¼ˆæ•µæ•°ãªã©ã€‚äºˆæ¸¬ä¸å¯èƒ½ï¼‰

### Buff ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆå®Œå…¨ç‰ˆ v1.2ï¼‰

```typescript
interface Buff {
  // åŸºæœ¬ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  id: string;
  stat: Stat;
  mode: BuffMode;
  value: number;
  source: 'self_skill' | 'ally_skill' | 'strategy' | 'formation_skill';
  target: Target;
  conditionTags?: ConditionTag[];
  isActive: boolean;
  
  // ç‰¹æ®Šãƒ•ãƒ©ã‚°
  isDuplicate?: boolean;      // åŠ¹æœé‡è¤‡ï¼ˆåˆ¥é€”è¨ˆç®—ã•ã‚Œã‚‹ï¼‰
  nonStacking?: boolean;      // é‡è¤‡ãªã—ï¼ˆæœ€å¤§å€¤ã®ã¿é©ç”¨ï¼‰
  stackPenalty?: number;      // é‡è¤‡æ™‚åŠ¹æœæ¸›å°‘ï¼ˆ0-100ã®æ¸›å°‘ç‡ï¼‰
  
  // å„ªå…ˆåº¦ï¼ˆåŒä¸€statã§è¤‡æ•°BuffãŒã‚ã‚‹å ´åˆã®é¸æŠåŸºæº–ï¼‰- v1.2ã§è¿½åŠ 
  priority?: 'low' | 'normal' | 'high';
  
  // å‹•çš„ãƒãƒ•é–¢é€£ - v1.2ã§è¿½åŠ 
  isDynamic?: boolean;
  dynamicType?: DynamicBuffType;
  dynamicCategory?: 'formation' | 'combat_situation';
  unitValue?: number;                // å˜ä½ã‚ãŸã‚Šã®åŠ¹æœå€¤
  dynamicParameter?: string;         // å‹•çš„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®èª¬æ˜
  
  // ä¼å…µä¾å­˜ãƒ•ãƒ©ã‚° - v1.2ã§è¿½åŠ 
  requiresAmbush?: boolean;   // ä¼å…µãŒé…ç½®ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹ãƒãƒ•
  
  // costå°‚ç”¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  costType?: CostBuffType;
  
  // inspireå°‚ç”¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  inspireSourceStat?: Stat;   // å‚ç…§å…ƒï¼ˆ'attack', 'defense'ç­‰ï¼‰
  
  // æ‰‹å‹•ç·¨é›†ã‚µãƒãƒ¼ãƒˆ - v1.2ã§è¿½åŠ 
  confidence?: 'certain' | 'inferred' | 'uncertain';
  inferenceReason?: string;
  
  // è£œè¶³æƒ…å ± - v1.2ã§è¿½åŠ 
  note?: string;              // åŠ¹æœæ™‚é–“ã€ç¯„å›²ã‚µã‚¤ã‚ºãªã©ã®è¿½åŠ æƒ…å ±
}
```

---

## ğŸ”„ æ—§ç‰ˆ â†’ Reborn å¤‰æ›ãƒãƒƒãƒ”ãƒ³ã‚°

### 1. æ”»æ’ƒãƒ»é˜²å¾¡ç³»

#### 1.1 æ”»æ’ƒãƒãƒ•

| æ—§type | æ—§unit | Reborn Stat | BuffMode | Target | å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ |
|--------|--------|-------------|----------|--------|------------|
| æ”»æ’ƒå‰²åˆ | `+%` | `attack` | `percent_max` | (å¯¾è±¡ä¾å­˜) | ãã®ã¾ã¾ |
| æ”»æ’ƒå‰²åˆ | `Ã—` | `attack` | `percent_max` | (å¯¾è±¡ä¾å­˜) | `(value - 1) Ã— 100` |
| æ”»æ’ƒå›ºå®š | `+` | `attack` | `flat_sum` | (å¯¾è±¡ä¾å­˜) | ãã®ã¾ã¾ |

**å¤‰æ›ä¾‹**:

```javascript
// æ—§: { type: 'æ”»æ’ƒå‰²åˆ', unit: '+%', value: 30, target: 'è‡ªèº«' }
// â†“
// æ–°: { stat: 'attack', mode: 'percent_max', value: 30, target: 'self' }

// æ—§: { type: 'æ”»æ’ƒå‰²åˆ', unit: 'Ã—', value: 1.5, target: 'å°„ç¨‹å†…' }
// â†“
// æ–°: { stat: 'attack', mode: 'percent_max', value: 50, target: 'range' }
//     â€» (1.5 - 1) Ã— 100 = 50
```

#### 1.2 é˜²å¾¡ãƒãƒ•

| æ—§type | æ—§unit | Reborn Stat | BuffMode | Target | å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ |
|--------|--------|-------------|----------|--------|------------|
| é˜²å¾¡å‰²åˆ | `+%` | `defense` | `percent_max` | (å¯¾è±¡ä¾å­˜) | ãã®ã¾ã¾ |
| é˜²å¾¡å‰²åˆ | `Ã—` | `defense` | `percent_max` | (å¯¾è±¡ä¾å­˜) | `(value - 1) Ã— 100` |
| é˜²å¾¡å›ºå®š | `+` | `defense` | `flat_sum` | (å¯¾è±¡ä¾å­˜) | ãã®ã¾ã¾ |

### 2. ãƒ€ãƒ¡ãƒ¼ã‚¸ç³»

#### 2.1 ä¸ãƒ€ãƒ¡ãƒ»è¢«ãƒ€ãƒ¡

| æ—§type | æ—§unit | Reborn Stat | BuffMode | å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ | å‚™è€ƒ |
|--------|--------|-------------|----------|------------|------|
| ä¸ãƒ€ãƒ¡ | `+%` | `damage_dealt` | `percent_max` | ãã®ã¾ã¾ | |
| ä¸ãƒ€ãƒ¡ | `Ã—` | `damage_dealt` | `percent_max` | `(value - 1) Ã— 100` | |
| è¢«ãƒ€ãƒ¡ | `+%` | `damage_taken` | `percent_max` | ãã®ã¾ã¾ | æ­£ã§å¢—åŠ  |
| è¢«ãƒ€ãƒ¡ | `-%` | `damage_taken` | `percent_max` | ãã®ã¾ã¾ | è² ã§æ¸›å°‘ |

**é‡è¦ãªæ³¨æ„ç‚¹**:

ã€Œä¸ãˆã‚‹ãƒ€ãƒ¡ãƒ¼ã‚¸ã€ã¨ã„ã†è¡¨è¨˜ãŒã‚ã‚‹å ´åˆã¯ã€**å®Œå…¨ä¸€è‡´**ã§åˆ¤å®šã—ã€`give_damage`ã¨ã—ã¦æ‰±ã„ã¾ã™ã€‚éƒ¨åˆ†ä¸€è‡´ã§ã€Œä¸ãƒ€ãƒ¡ã€ã¨æ··åŒã—ãªã„ã‚ˆã†æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚

```javascript
// æ—§: { type: 'ä¸ãˆã‚‹ãƒ€ãƒ¡ãƒ¼ã‚¸', unit: '+%', value: 30 }
// â†“
// æ–°: { stat: 'give_damage', mode: 'percent_max', value: 30 }
```

#### 2.2 ä¸ãƒ€ãƒ¡å›å¾©

| æ—§type | æ—§unit | Reborn Stat | BuffMode | å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ |
|--------|--------|-------------|----------|------------|
| ä¸ãƒ€ãƒ¡å›å¾© | `+%` | `damage_recovery` | `percent_max` | ãã®ã¾ã¾ |

### 3. é€Ÿåº¦ãƒ»éš™ç³»

#### 3.1 æ”»æ’ƒé€Ÿåº¦

| æ—§type | æ—§unit | Reborn Stat | BuffMode | å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ | å‚™è€ƒ |
|--------|--------|-------------|----------|------------|------|
| é€Ÿåº¦ | `+%` | `attack_speed` | `percent_max` | ãã®ã¾ã¾ | ä¸Šæ˜‡ |
| é€Ÿåº¦ | `-%` | `attack_speed` | `percent_max` | ãã®ã¾ã¾ï¼ˆè² ã®å€¤ï¼‰ | ä½ä¸‹ |

#### 3.2 æ”»æ’ƒéš™

| æ—§type | æ—§unit | Reborn Stat | BuffMode | å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ | å‚™è€ƒ |
|--------|--------|-------------|----------|------------|------|
| éš™ | `+%` | `attack_gap` | `percent_reduction` | ãã®ã¾ã¾ | çŸ­ç¸® |
| éš™ | `-%` | `attack_gap` | `percent_max` | ãã®ã¾ã¾ï¼ˆè² ã®å€¤ï¼‰ | å¢—åŠ  |

**é‡è¦ãªæ³¨æ„ç‚¹**:

éš™ã®ã€Œ+%ã€ã¯çŸ­ç¸®ã‚’æ„å‘³ã™ã‚‹ãŸã‚ã€`percent_reduction`ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ä¸€æ–¹ã€ã€Œ-%ã€ã¯å¢—åŠ ã‚’æ„å‘³ã™ã‚‹ãŸã‚ã€`percent_max`ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```javascript
// æ—§: { type: 'éš™', unit: '+%', value: 30 }
// â†“
// æ–°: { stat: 'attack_gap', mode: 'percent_reduction', value: 30 }
// æ„å‘³: éš™ãŒ30%çŸ­ç¸®ã•ã‚Œã‚‹

// æ—§: { type: 'éš™', unit: '-%', value: 20 }
// â†“
// æ–°: { stat: 'attack_gap', mode: 'percent_max', value: -20 }
// æ„å‘³: éš™ãŒ20%å¢—åŠ ã™ã‚‹
```

### 4. æ°—ãƒ»è¨ˆç•¥ç³»

#### 4.1 æ°—ãƒãƒ•

**é‡è¦**: ã™ã¹ã¦ã®æ°—ãƒãƒ•ã¯ `target: 'field'` ã¨ãªã‚Šã¾ã™ã€‚

| æ—§type | æ—§unit | Reborn Stat | costType | BuffMode | Target | å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ |
|--------|--------|-------------|----------|----------|--------|------------|
| è‡ªç„¶æ°— | `+` | `cost` | `natural` | `flat_sum` | `field` | ãã®ã¾ã¾ |
| æ°—(ç‰›) | `+` | `cost` | `enemy_defeat` | `flat_sum` | `field` | ãã®ã¾ã¾ |
| æ°—(ãƒãƒ“) | `+` | `cost` | `ally_defeat` | `flat_sum` | `field` | ãã®ã¾ã¾ |
| æ°—è»½æ¸› | `+%` | `cost` | `giant_cost` | `percent_reduction` | `field` | ãã®ã¾ã¾ |
| è¨ˆç•¥æ¶ˆè²»æ°— | `+` | `cost` | `strategy_cost` | `flat_sum` | `field` | ãã®ã¾ã¾ |

**å¤‰æ›ä¾‹**:

```javascript
// æ—§: { type: 'è‡ªç„¶æ°—', unit: '+', value: 5, target: 'è‡ªèº«' }
// â†“
// æ–°: { 
//   stat: 'cost', 
//   costType: 'natural', 
//   mode: 'flat_sum', 
//   value: 5, 
//   target: 'field'  // â˜… æ—§ç‰ˆã®targetã¯ç„¡è¦–ã—ã€å¸¸ã«field
// }
```

#### 4.2 è¨ˆç•¥çŸ­ç¸®

| æ—§type | æ—§unit | Reborn Stat | BuffMode | å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ |
|--------|--------|-------------|----------|------------|
| è¨ˆç•¥çŸ­ç¸® | `+%` | `strategy_cooldown` | `percent_reduction` | ãã®ã¾ã¾ |

### 5. å°„ç¨‹ãƒ»å¯¾è±¡æ•°ç³»

| æ—§type | æ—§unit | Reborn Stat | BuffMode | å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ |
|--------|--------|-------------|----------|------------|
| å°„ç¨‹å‰²åˆ | `+%` | `range` | `percent_max` | ãã®ã¾ã¾ |
| å°„ç¨‹å‰²åˆ | `-%` | `range` | `percent_max` | ãã®ã¾ã¾ï¼ˆè² ã®å€¤ï¼‰ |
| å°„ç¨‹å›ºå®š | `+` | `range` | `flat_sum` | ãã®ã¾ã¾ |
| å°„ç¨‹å›ºå®š | `-` | `range` | `flat_sum` | ãã®ã¾ã¾ï¼ˆè² ã®å€¤ï¼‰ |
| å¯¾è±¡æ•° | `+` | `target_count` | `flat_sum` | ãã®ã¾ã¾ |
| å¯¾è±¡æ•° | `-` | `target_count` | `flat_sum` | ãã®ã¾ã¾ï¼ˆè² ã®å€¤ï¼‰ |

### 6. å›å¾©ç³»

| æ—§type | æ—§unit | Reborn Stat | BuffMode | å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ |
|--------|--------|-------------|----------|------------|
| å›å¾© | `+` | `recovery` | `flat_sum` | ãã®ã¾ã¾ |
| å›å¾©å‰²åˆ | `Ã—` | `recovery` | `percent_max` | `(value - 1) Ã— 100` |

### 7. æ”»æ’ƒå›æ•°

| æ—§type | æ—§unit | Reborn Stat | BuffMode | å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ |
|--------|--------|-------------|----------|------------|
| æ”»æ’ƒå›æ•° | `+` | `attack_count` | `flat_sum` | ãã®ã¾ã¾ |

### 8. æ•µãƒ‡ãƒãƒ•ç³»

#### 8.1 æ•µæ”»æ’ƒåŠ›

| æ—§type | æ—§unit | Reborn Stat | BuffMode | å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ |
|--------|--------|-------------|----------|------------|
| æ”»æ’ƒãƒ‡ãƒãƒ•å‰²åˆ | `+%` | `enemy_attack` | `percent_max` | ãã®ã¾ã¾ |
| æ”»æ’ƒãƒ‡ãƒãƒ•å›ºå®š | `+` | `enemy_attack` | `flat_sum` | ãã®ã¾ã¾ |

#### 8.2 æ•µé˜²å¾¡åŠ›

| æ—§type | æ—§unit | Reborn Stat | BuffMode | å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ | å‚™è€ƒ |
|--------|--------|-------------|----------|------------|------|
| é˜²å¾¡ãƒ‡ãƒãƒ•å‰²åˆ | `+%` | `enemy_defense` | `percent_max` | ãã®ã¾ã¾ | |
| é˜²å¾¡ãƒ‡ãƒãƒ•å›ºå®š | `+` | `enemy_defense` | `flat_sum` | ãã®ã¾ã¾ | |
| é˜²å¾¡ç„¡è¦– | - | `enemy_defense_ignore_complete` | `flat_sum` | `value = 1` | ãƒ•ãƒ©ã‚°ã¨ã—ã¦æ‰±ã† |
| é˜²å¾¡ç„¡è¦–ï¼ˆå‰²åˆï¼‰ | `%` | `enemy_defense_ignore_percent` | `percent_max` | ãã®ã¾ã¾ | |

**é˜²å¾¡ç„¡è¦–ã®å¤‰æ›ä¾‹**:

```javascript
// æ—§: { type: 'é˜²å¾¡ç„¡è¦–', unit: '', value: 0 }
// â†“
// æ–°: { stat: 'enemy_defense_ignore_complete', mode: 'flat_sum', value: 1 }
```

#### 8.3 ç§»å‹•é€Ÿåº¦ãƒ»ãƒãƒƒã‚¯ãƒãƒƒã‚¯

| æ—§type | æ—§unit | Reborn Stat | BuffMode | å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ | å‚™è€ƒ |
|--------|--------|-------------|----------|------------|------|
| ç§»å‹•ä½ä¸‹ | `-%` | `enemy_movement` | `percent_max` | ãã®ã¾ã¾ | è² ã®å€¤ |
| ç§»å‹•å¾Œé€€ | `+` | `enemy_knockback` | `flat_sum` | ãã®ã¾ã¾ | ãƒã‚¹æ•° |

### 9. é¼“èˆï¼ˆç‰¹æ®Šå‡¦ç†ï¼‰

é¼“èˆã¯ã€è‡ªèº«ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å‚ç…§ã—ã¦å‘³æ–¹ã«åŠ ç®—ã™ã‚‹ç‰¹æ®Šãªãƒãƒ•ã§ã™ã€‚

**æ¤œå‡ºãƒ‘ã‚¿ãƒ¼ãƒ³**:
- ã€Œè‡ªèº«ã®ã€‡ã€‡ã®â–³%ã‚’åŠ ç®—ã€
- ã€Œè‡ªèº«ã®ã€‡ã€‡ã®â–³%ã‚’å°„ç¨‹å†…ã«åŠ ç®—ã€

**å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯**:

```javascript
// æ—§: { type: 'é¼“èˆ', unit: '%', value: 30, source: 'attack', target: 'å°„ç¨‹å†…' }
// â†“
// æ–°: { 
//   stat: 'inspire',
//   mode: 'percent_max',
//   value: 30,
//   inspireSourceStat: 'attack',  // å‚ç…§å…ƒ
//   target: 'range'
// }
```

**è¤‡æ•°ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å‚ç…§ã®å ´åˆ**:

ã€Œè‡ªèº«ã®æ”»æ’ƒã¨é˜²å¾¡ã®30%ã‚’å°„ç¨‹å†…ã«åŠ ç®—ã€ã®ã‚ˆã†ãªå ´åˆã€**åˆ¥ã€…ã®Buffã¨ã—ã¦ç”Ÿæˆ**ã—ã¾ã™ã€‚

```javascript
// æ—§ãƒ†ã‚­ã‚¹ãƒˆ: ã€Œè‡ªèº«ã®æ”»æ’ƒã¨é˜²å¾¡ã®30%ã‚’å°„ç¨‹å†…ã«åŠ ç®—ã€
// â†“
// æ–°: [
//   { stat: 'inspire', inspireSourceStat: 'attack', value: 30, target: 'range' },
//   { stat: 'inspire', inspireSourceStat: 'defense', value: 30, target: 'range' }
// ]
```

---

## ğŸš¨ ç‰¹æ®Šãƒ•ãƒ©ã‚°ã®æ¤œå‡ºã¨è¨­å®š

### 1. åŠ¹æœé‡è¤‡ï¼ˆisDuplicateï¼‰

ã€ŒåŠ¹æœé‡è¤‡ã€ã€ŒåŒç¨®åŠ¹æœé‡è¤‡ã€ã¨ã„ã£ãŸè¡¨è¨˜ãŒã‚ã‚‹å ´åˆã€`isDuplicate: true`ã‚’è¨­å®šã—ã¾ã™ã€‚

**æ¤œå‡ºãƒ‘ã‚¿ãƒ¼ãƒ³**:
- `(åŠ¹æœé‡è¤‡)`
- `(åŒç¨®åŠ¹æœé‡è¤‡)`

**å¤‰æ›ä¾‹**:

```javascript
// æ—§ãƒ†ã‚­ã‚¹ãƒˆ: ã€Œæ•µã®é˜²å¾¡ãŒ5%ä½ä¸‹(åŠ¹æœé‡è¤‡)ã€
// â†“
// æ–°: {
//   stat: 'enemy_defense',
//   mode: 'percent_max',
//   value: 5,
//   isDuplicate: true
// }
```

### 2. é‡è¤‡ãªã—ï¼ˆnonStackingï¼‰

ã€Œé‡è¤‡ãªã—ã€ã¨ã„ã†è¡¨è¨˜ãŒã‚ã‚‹å ´åˆã€`nonStacking: true`ã‚’è¨­å®šã—ã¾ã™ã€‚

**æ¤œå‡ºãƒ‘ã‚¿ãƒ¼ãƒ³**:
- `(é‡è¤‡ãªã—)`

**å¤‰æ›ä¾‹**:

```javascript
// æ—§ãƒ†ã‚­ã‚¹ãƒˆ: ã€Œæ”»æ’ƒãŒ50%ä¸Šæ˜‡(é‡è¤‡ãªã—)ã€
// â†“
// æ–°: {
//   stat: 'attack',
//   mode: 'percent_max',
//   value: 50,
//   nonStacking: true
// }
```

### 3. é‡è¤‡æ™‚åŠ¹æœæ¸›å°‘ï¼ˆstackPenaltyï¼‰

ã€Œé‡è¤‡æ™‚åŠ¹æœ50%æ¸›å°‘ã€ã®ã‚ˆã†ãªè¡¨è¨˜ãŒã‚ã‚‹å ´åˆã€`stackPenalty: 50`ã‚’è¨­å®šã—ã¾ã™ã€‚

**æ¤œå‡ºãƒ‘ã‚¿ãƒ¼ãƒ³**:
- `(é‡è¤‡æ™‚åŠ¹æœâ—‹%æ¸›å°‘)`

**å¤‰æ›ä¾‹**:

```javascript
// æ—§ãƒ†ã‚­ã‚¹ãƒˆ: ã€Œæ”»æ’ƒãŒ30%ä¸Šæ˜‡(é‡è¤‡æ™‚åŠ¹æœ50%æ¸›å°‘)ã€
// â†“
// æ–°: {
//   stat: 'attack',
//   mode: 'percent_max',
//   value: 30,
//   stackPenalty: 50
// }
```

### 4. å‹•çš„ãƒãƒ•ï¼ˆisDynamicï¼‰- v1.2ã§è¿½åŠ 

ã€Œå‘³æ–¹1ä½“ã«ã¤ãã€ã€Œæ•µ1ä½“æ¯ã«ã€ã¨ã„ã£ãŸè¡¨è¨˜ãŒã‚ã‚‹å ´åˆã€`isDynamic: true`ã‚’è¨­å®šã—ã¾ã™ã€‚

**æ¤œå‡ºãƒ‘ã‚¿ãƒ¼ãƒ³ã¨dynamicType**:

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | dynamicType | dynamicCategory |
|---------|-------------|-----------------|
| å‘³æ–¹1ä½“ã«ã¤ã | `per_ally_other` | `formation` |
| å°„ç¨‹å†…æ•µ1ä½“æ¯ã« | `per_enemy_in_range` | `combat_situation` |
| å°„ç¨‹å†…å‘³æ–¹1ä½“æ¯ã« | `per_ally_in_range` | `formation` |
| é…ç½®ã•ã‚ŒãŸä¼å…µ1ä½“ã«ã¤ã | `per_ambush_deployed` | `formation` |

**å¤‰æ›ä¾‹**:

```javascript
// æ—§ãƒ†ã‚­ã‚¹ãƒˆ: ã€Œå‘³æ–¹1ä½“ã«ã¤ãæ”»æ’ƒãŒ150ä¸Šæ˜‡ã€
// â†“
// æ–°: {
//   stat: 'attack',
//   mode: 'flat_sum',
//   value: 150,
//   isDynamic: true,
//   dynamicType: 'per_ally_other',
//   dynamicCategory: 'formation',
//   unitValue: 150,
//   dynamicParameter: 'å‘³æ–¹1ä½“ã«ã¤ã'
// }
```

### 5. ä¼å…µä¾å­˜ï¼ˆrequiresAmbushï¼‰- v1.2ã§è¿½åŠ 

ã€Œä¼å…µã®å°„ç¨‹å†…ã€ã¨ã„ã†è¡¨è¨˜ãŒã‚ã‚‹å ´åˆã€`requiresAmbush: true`ã‚’è¨­å®šã—ã¾ã™ã€‚

**æ¤œå‡ºãƒ‘ã‚¿ãƒ¼ãƒ³**:
- `ä¼å…µã®å°„ç¨‹å†…`

**å¤‰æ›ä¾‹**:

```javascript
// æ—§ãƒ†ã‚­ã‚¹ãƒˆ: ã€Œä¼å…µã®å°„ç¨‹å†…ã®åŸå¨˜ã®æ”»æ’ƒãŒ120ä¸Šæ˜‡ã€
// â†“
// æ–°: {
//   stat: 'attack',
//   mode: 'flat_sum',
//   value: 120,
//   target: 'range',
//   isDynamic: true,
//   requiresAmbush: true,
//   note: 'ä¼å…µã®å°„ç¨‹å†…ã€é…ç½®ä½ç½®ã¨ä¼å…µã®ç¨®é¡ã«ä¾å­˜'
// }
```

### 6. ç¢ºä¿¡åº¦ï¼ˆconfidenceï¼‰- v1.2ã§è¿½åŠ 

ãƒ‘ãƒ¼ã‚µãƒ¼ãŒæ¨æ¸¬ã«åŸºã¥ã„ã¦åˆ¤æ–­ã—ãŸå ´åˆã€`confidence: 'inferred'`ã¾ãŸã¯`'uncertain'`ã‚’è¨­å®šã—ã¾ã™ã€‚

**è¨­å®šåŸºæº–**:

| Confidence | æ„å‘³ | ä¾‹ |
|-----------|------|-----|
| `certain` | ç¢ºå®Ÿ | æ˜ç¤ºçš„ãªè¡¨è¨˜ãŒã‚ã‚‹ |
| `inferred` | æ¨æ¸¬ | ä¸»èªãŒçœç•¥ã•ã‚Œã¦ã„ã‚‹ãŒã€æ–‡è„ˆã‹ã‚‰åˆ¤æ–­å¯èƒ½ |
| `uncertain` | ä¸ç¢ºå®Ÿ | è¤‡é›‘ãªæ§‹é€ ã§ã€äººé–“ã®ç¢ºèªãŒå¿…è¦ |

**å¤‰æ›ä¾‹**:

```javascript
// æ—§ãƒ†ã‚­ã‚¹ãƒˆ: ã€Œé˜²å¾¡ãŒ30%ä¸Šæ˜‡ã€ï¼ˆä¸»èªçœç•¥ï¼‰
// â†“
// æ–°: {
//   stat: 'defense',
//   mode: 'percent_max',
//   value: 30,
//   target: 'self',  // æ–‡è„ˆã‹ã‚‰æ¨æ¸¬
//   confidence: 'inferred',
//   inferenceReason: 'ä¸»èªãŒçœç•¥ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€selfã¨æ¨æ¸¬'
// }
```

---

## ğŸ“ Target ã®å¤‰æ›ãƒ«ãƒ¼ãƒ« - v1.2ã§è¿½åŠ 

æ—§ç‰ˆã®`target`è¡¨è¨˜ã‚’ã€æ–°ç‰ˆã®6ç¨®é¡ã®Targetã«å¤‰æ›ã—ã¾ã™ã€‚

### åŸºæœ¬çš„ãªå¤‰æ›ãƒãƒƒãƒ”ãƒ³ã‚°

| æ—§target | æ–°Target | å‚™è€ƒ |
|---------|---------|------|
| è‡ªèº« | `self` | |
| å¯¾è±¡ | `ally` | è¨ˆç•¥ã§ã®å¯¾è±¡æŒ‡å®š |
| å°„ç¨‹å†… | `range` | |
| å‘³æ–¹ | `range` | é€šå¸¸ã¯å°„ç¨‹å†…ã¨åŒç¾© |
| å…¨ã¦ | `all` | ç·¨æˆç‰¹æŠ€ãªã© |
| åŸå¨˜ | `range` ã¾ãŸã¯ `all` | æ–‡è„ˆã«ã‚ˆã‚‹ |

### ç‰¹æ®Šãªã‚±ãƒ¼ã‚¹

**1. æ°—ãƒãƒ•**
- æ—§targetã«é–¢ã‚ã‚‰ãšã€å¸¸ã« `target: 'field'`

```javascript
// æ—§: { type: 'è‡ªç„¶æ°—', target: 'è‡ªèº«', value: 5 }
// â†“
// æ–°: { stat: 'cost', costType: 'natural', target: 'field', value: 5 }
```

**2. å°„ç¨‹å¤–ãƒãƒ•ï¼ˆç”²åºœåŸãªã©ï¼‰**
- ã€Œå°„ç¨‹å¤–ã€ã¨ã„ã†è¡¨è¨˜ãŒã‚ã‚‹å ´åˆã€`target: 'out_of_range'`

```javascript
// æ—§ãƒ†ã‚­ã‚¹ãƒˆ: ã€Œå°„ç¨‹å¤–ã®å‘³æ–¹ã®é˜²å¾¡ãŒ30%ä¸Šæ˜‡ã€
// â†“
// æ–°: { stat: 'defense', mode: 'percent_max', value: 30, target: 'out_of_range' }
```

**3. è¨ˆç•¥ç¯„å›²ãƒãƒ•**
- ç¯„å›²ã‚µã‚¤ã‚ºã«åŸºã¥ã„ã¦å¤‰æ›ï¼ˆPARSING_RULES.md ãƒ‘ã‚¿ãƒ¼ãƒ³23å‚ç…§ï¼‰

| ç¯„å›²ã‚µã‚¤ã‚º | Target |
|-----------|--------|
| è¶…ç‰¹å¤§ã€ç‰¹å¤§ã€å¤§ | `range` |
| ä¸­ã€å° | `ally` |

```javascript
// æ—§ãƒ†ã‚­ã‚¹ãƒˆ: ã€Œç¯„å›²å†…ã®åŸå¨˜ã®æ”»æ’ƒãŒ30%ä¸Šæ˜‡(ç¯„å›²ï¼šè¶…ç‰¹å¤§)ã€
// â†“
// æ–°: {
//   stat: 'attack',
//   mode: 'percent_max',
//   value: 30,
//   target: 'range',
//   note: 'ç¯„å›²ï¼šè¶…ç‰¹å¤§'
// }
```

---

## ğŸ§ª å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…ä¾‹

### TypeScriptå®Ÿè£…ã‚µãƒ³ãƒ—ãƒ«

```typescript
// converter.ts

import { ParsedBuff, Buff } from './types';

export function convertToRebornBuff(parsed: ParsedBuff): Buff {
  const buff: Buff = {
    id: generateId(),
    stat: convertStat(parsed.type),
    mode: convertMode(parsed.unit, parsed.type),
    value: convertValue(parsed.value, parsed.unit),
    source: 'self_skill', // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆå¾Œã§èª¿æ•´ï¼‰
    target: convertTarget(parsed.target, parsed.type),
    isActive: true
  };
  
  // ç‰¹æ®Šãƒ•ãƒ©ã‚°ã®æ¤œå‡º
  if (parsed.note.includes('åŠ¹æœé‡è¤‡')) {
    buff.isDuplicate = true;
  }
  
  if (parsed.note.includes('é‡è¤‡ãªã—')) {
    buff.nonStacking = true;
  }
  
  // é‡è¤‡æ™‚åŠ¹æœæ¸›å°‘ã®æ¤œå‡º
  const penaltyMatch = parsed.note.match(/é‡è¤‡æ™‚åŠ¹æœ(\d+)%æ¸›å°‘/);
  if (penaltyMatch) {
    buff.stackPenalty = parseInt(penaltyMatch[1]);
  }
  
  // å‹•çš„ãƒãƒ•ã®æ¤œå‡º
  const dynamicInfo = detectDynamicBuff(parsed.rawText);
  if (dynamicInfo) {
    buff.isDynamic = true;
    buff.dynamicType = dynamicInfo.type;
    buff.dynamicCategory = dynamicInfo.category;
    buff.unitValue = parsed.value;
    buff.dynamicParameter = dynamicInfo.parameter;
  }
  
  // ä¼å…µä¾å­˜ã®æ¤œå‡º
  if (parsed.rawText.includes('ä¼å…µã®å°„ç¨‹å†…')) {
    buff.requiresAmbush = true;
  }
  
  // æ°—ãƒãƒ•ã®ç‰¹åˆ¥å‡¦ç†
  if (buff.stat === 'cost') {
    buff.target = 'field'; // å¸¸ã«field
    buff.costType = detectCostType(parsed.type);
  }
  
  // é¼“èˆã®ç‰¹åˆ¥å‡¦ç†
  if (isInspireBuff(parsed)) {
    buff.stat = 'inspire';
    buff.inspireSourceStat = extractInspireSource(parsed.rawText);
  }
  
  return buff;
}

function convertStat(type: string): Stat {
  const mapping: Record<string, Stat> = {
    'æ”»æ’ƒå‰²åˆ': 'attack',
    'æ”»æ’ƒå›ºå®š': 'attack',
    'é˜²å¾¡å‰²åˆ': 'defense',
    'é˜²å¾¡å›ºå®š': 'defense',
    'é€Ÿåº¦': 'attack_speed',
    'éš™': 'attack_gap',
    'ä¸ãƒ€ãƒ¡': 'damage_dealt',
    'ä¸ãˆã‚‹ãƒ€ãƒ¡ãƒ¼ã‚¸': 'give_damage',
    'è¢«ãƒ€ãƒ¡': 'damage_taken',
    'è‡ªç„¶æ°—': 'cost',
    'æ°—(ç‰›)': 'cost',
    'æ°—(ãƒãƒ“)': 'cost',
    // ... ãã®ä»–ã®ãƒãƒƒãƒ”ãƒ³ã‚°
  };
  
  return mapping[type] || 'attack'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
}

function convertMode(unit: string, type: string): BuffMode {
  // éš™ã®ç‰¹åˆ¥å‡¦ç†
  if (type === 'éš™') {
    return unit === '+%' ? 'percent_reduction' : 'percent_max';
  }
  
  // æ°—è»½æ¸›ãªã©ã®æ¸›å°‘ç³»
  if (type.includes('è»½æ¸›') || type.includes('çŸ­ç¸®')) {
    return 'percent_reduction';
  }
  
  // åŸºæœ¬çš„ãªåˆ¤å®š
  if (unit === '+%' || unit === 'Ã—' || unit === '-%') {
    return 'percent_max';
  }
  
  return 'flat_sum';
}

function convertValue(value: number, unit: string): number {
  // å€ç‡è¡¨è¨˜ã®å¤‰æ›
  if (unit === 'Ã—' && value >= 1) {
    return (value - 1) * 100;
  }
  
  return value;
}

function convertTarget(target: string, type: string): Target {
  // æ°—ãƒãƒ•ã¯å¸¸ã«field
  if (type.includes('æ°—') || type.includes('è‡ªç„¶æ°—')) {
    return 'field';
  }
  
  // åŸºæœ¬çš„ãªãƒãƒƒãƒ”ãƒ³ã‚°
  const mapping: Record<string, Target> = {
    'è‡ªèº«': 'self',
    'å¯¾è±¡': 'ally',
    'å°„ç¨‹å†…': 'range',
    'å‘³æ–¹': 'range',
    'å…¨ã¦': 'all',
    'å°„ç¨‹å¤–': 'out_of_range'
  };
  
  return mapping[target] || 'self';
}

function detectDynamicBuff(text: string): DynamicBuffInfo | null {
  const patterns = [
    { regex: /å‘³æ–¹(\d+)ä½“ã«ã¤ã/, type: 'per_ally_other', category: 'formation' },
    { regex: /å°„ç¨‹å†…æ•µ(\d+)ä½“æ¯ã«/, type: 'per_enemy_in_range', category: 'combat_situation' },
    { regex: /ä¼å…µ(\d+)ä½“ã«ã¤ã/, type: 'per_ambush_deployed', category: 'formation' },
    // ... ãã®ä»–ã®ãƒ‘ã‚¿ãƒ¼ãƒ³
  ];
  
  for (const pattern of patterns) {
    const match = text.match(pattern.regex);
    if (match) {
      return {
        type: pattern.type,
        category: pattern.category,
        parameter: match[0]
      };
    }
  }
  
  return null;
}
```

---

## âœ… å¤‰æ›å¾Œã®æ¤œè¨¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

å¤‰æ›ãŒæ­£ã—ãè¡Œã‚ã‚ŒãŸã‹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã§ã™ã€‚

### åŸºæœ¬ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- [ ] `stat`ãŒæ­£ã—ã„ã‚«ãƒ†ã‚´ãƒªï¼ˆAlly/Damage/Enemy/Specialï¼‰ã«å±ã—ã¦ã„ã‚‹
- [ ] `mode`ãŒ`stat`ã¨é©åˆ‡ã«çµ„ã¿åˆã‚ã•ã‚Œã¦ã„ã‚‹
- [ ] `value`ãŒæ­£ã—ãå¤‰æ›ã•ã‚Œã¦ã„ã‚‹ï¼ˆå€ç‡â†’%å¤‰æ›ãªã©ï¼‰
- [ ] `target`ãŒ6ç¨®é¡ã®ã„ãšã‚Œã‹ã«ãªã£ã¦ã„ã‚‹

### ç‰¹æ®Šãƒ•ãƒ©ã‚°
- [ ] ã€ŒåŠ¹æœé‡è¤‡ã€è¡¨è¨˜ãŒã‚ã‚‹å ´åˆã€`isDuplicate: true`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ã€Œé‡è¤‡ãªã—ã€è¡¨è¨˜ãŒã‚ã‚‹å ´åˆã€`nonStacking: true`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ã€Œé‡è¤‡æ™‚åŠ¹æœâ—‹%æ¸›å°‘ã€è¡¨è¨˜ãŒã‚ã‚‹å ´åˆã€`stackPenalty`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹

### ã‚µãƒ–ã‚¿ã‚¤ãƒ—
- [ ] æ°—ãƒãƒ•ã®å ´åˆã€`costType`ãŒè¨­å®šã•ã‚Œã€`target: 'field'`ã«ãªã£ã¦ã„ã‚‹
- [ ] é¼“èˆã®å ´åˆã€`stat: 'inspire'`ã§`inspireSourceStat`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹

### å‹•çš„ãƒãƒ•ï¼ˆv1.2ï¼‰
- [ ] å‹•çš„ãƒãƒ•ã®å ´åˆã€`isDynamic: true`ã¨`dynamicType`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] `dynamicCategory`ãŒ`formation`ã¾ãŸã¯`combat_situation`ã«ãªã£ã¦ã„ã‚‹
- [ ] `unitValue`ãŒå˜ä½ã‚ãŸã‚Šã®åŠ¹æœå€¤ã¨ã—ã¦è¨­å®šã•ã‚Œã¦ã„ã‚‹

### ä¼å…µãƒãƒ•ï¼ˆv1.2ï¼‰
- [ ] ä¼å…µä¾å­˜ã®å ´åˆã€`requiresAmbush: true`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] é€šå¸¸ã¯`isDynamic: true`ã‚‚ä½µã›ã¦è¨­å®šã•ã‚Œã‚‹

### ç¢ºä¿¡åº¦ï¼ˆv1.2ï¼‰
- [ ] æ¨æ¸¬ã«åŸºã¥ãå¤‰æ›ã®å ´åˆã€`confidence: 'inferred'`ã¾ãŸã¯`'uncertain'`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] `inferenceReason`ã«æ¨æ¸¬ã®ç†ç”±ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹

---

## ğŸ“š å¤‰æ›´å±¥æ­´

### v1.2 (2025-12-07)
- **Targetã‚’6ç¨®é¡ã«æ‹¡å¼µ**ï¼ˆself, ally, range, all, field, out_of_rangeï¼‰
- **å‹•çš„ãƒãƒ•ã®æ¦‚å¿µã‚’è¿½åŠ **ï¼ˆisDynamic, dynamicType, dynamicCategoryï¼‰
- **ä¼å…µä¾å­˜ãƒ•ãƒ©ã‚°ã‚’è¿½åŠ **ï¼ˆrequiresAmbushï¼‰
- **ç¢ºä¿¡åº¦ãƒ•ãƒ©ã‚°ã‚’è¿½åŠ **ï¼ˆconfidence, inferenceReasonï¼‰
- **è£œè¶³æƒ…å ±ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ **ï¼ˆnoteï¼‰
- **å„ªå…ˆåº¦ãƒ•ãƒ©ã‚°ã‚’è¿½åŠ **ï¼ˆpriorityï¼‰
- è¨ˆç•¥ç¯„å›²ãƒãƒ•ã®å¤‰æ›ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ 
- æ°—ãƒãƒ•ã¯å¸¸ã«`target: 'field'`ã¨ãªã‚‹ã“ã¨ã‚’æ˜è¨˜
- Targetå¤‰æ›ãƒ«ãƒ¼ãƒ«ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 

### v1.1 (2025-12-06)
- é€Ÿåº¦ã¨éš™ã®åˆ†é›¢ã«ã¤ã„ã¦è©³ç´°ã‚’è¿½åŠ 
- é¼“èˆã®å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ã‚’è©³ç´°åŒ–
- åŠ¹æœé‡è¤‡ã®æ¤œå‡ºãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¿½åŠ 

### v1.0 (2025-12-06)
- åˆç‰ˆä½œæˆ
- åŸºæœ¬çš„ãªå‹å¤‰æ›ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’å®šç¾©
- æ—§buffParser.jsã®å‡ºåŠ›å½¢å¼ã‚’åˆ†æ

---

*Last Updated: 2025-12-07*  
*Version: 1.2*  
*Status: Complete*
